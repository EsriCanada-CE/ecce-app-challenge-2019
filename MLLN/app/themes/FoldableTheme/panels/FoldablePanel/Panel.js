// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/keys dojo/aspect jimu/BaseWidgetPanel jimu/BaseWidgetFrame jimu/utils ./FoldableDijit ./FoldableWidgetFrame".split(" "),function(l,c,b,f,d,e,m,n,p,h,q,r){return l([n,q],{baseClass:"jimu-panel jimu-foldable-dijit jimu-foldable-panel",closeTolerance:30,openAnimation:"fadeIn",closeAnimation:"fadeOut",animationDuration:500,postMixInProperties:function(){this.headerNls=window.jimuNls.panelHeader},startup:function(){this.titleHeight=
35;this.inherited(arguments);b.addClass(this.titleNode,"jimu-panel-title jimu-main-background");this.createFoldableBtn();this.createMaxBtn();this.createCloseBtn();this.panelManager.normalizePanel(this);b.setAttr(this.domNode,"role","application");this.own(d(this.domNode,"keydown",c.hitch(this,function(a){b.hasClass(a.target,"close-btn")||a.keyCode!==e.ESCAPE||this.closeNode.focus()})))},getPanelPosition:function(){if(window.appInfo.isRunInMobile)return this.panelManager.getPositionOnMobile(this);
var a=c.clone(this.position);"undefined"===typeof a.width&&(a.width=360);"minimized"===this.windowState?(a.bottom="auto",a.height=this.titleHeight,a.borderRadiusStyle={borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}):(a.bottom=this.position.bottom,a.height="auto",a.borderRadiusStyle={borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:"4px",borderBottomRightRadius:"4px"});return a},onOpen:function(){this.inherited(arguments);
this.onNormalize();if(h.isInNavMode()&&"minimized"===this.windowState)this.onFoldableNodeClick()},onNormalize:function(){this.resize()},onMaximize:function(){this.resize()},onMinimize:function(){this.resize()},resize:function(){this._switchMaxBtn();this._switchParentNode();var a=this.getPanelPosition();this.position.zIndex&&(a.zIndex=this.position.zIndex);var k=h.getPositionStyle(a);c.mixin(k,a.borderRadiusStyle);b.setStyle(this.domNode,k);1<this.getChildren().length&&this._setFrameSize(a.contentHeight);
this.inherited(arguments)},reloadWidget:function(a){this.inherited(arguments);this.isWidgetInPanel(a)&&(Array.isArray(this.config.widgets)||this.setTitleLabel(a.label))},updateConfig:function(a){this.inherited(arguments);this.setTitleLabel(a.label)},_switchMaxBtn:function(){window.appInfo.isRunInMobile?b.setStyle(this.maxNode,"display",""):b.setStyle(this.maxNode,"display","none")},_switchParentNode:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==b.byId(jimuConfig.layoutId)?
b.place(this.domNode,jimuConfig.layoutId):!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==b.byId(this.map.id)&&b.place(this.domNode,this.map.id)},_setFrameSize:function(a){var c,g=0;f.forEach(this.getChildren(),function(a){a.folded||g++},this);"undefined"===typeof a&&(a=b.getContentBox(this.containerNode).h);c=(a-(this.getChildren().length-g)*this.getChildren()[0].titleHeight)/g;f.forEach(this.getChildren(),function(a){a.folded?b.setStyle(a.domNode,{height:a.titleHeight+"px"}):
b.setStyle(a.domNode,{height:c+"px"});a.resize()},this)},createCloseBtn:function(){this.closeNode=b.create("div",{"class":"close-btn",role:"button","aria-label":this.headerNls.closeWindow,tabindex:0},this.btnsContainer);this.own(d(this.closeNode,"click",c.hitch(this,function(a){a.stopPropagation();this.panelManager.closePanel(this)})));this.own(d(this.closeNode,"keydown",c.hitch(this,function(a){a.keyCode!==e.ENTER&&a.keyCode!==e.SPACE||this.panelManager.closePanel(this)})))},createMaxBtn:function(){this.maxNode=
b.create("div",{"class":"max-btn",role:"button","aria-label":this.headerNls.maxWindow,tabindex:0},this.btnsContainer);this.own(d(this.maxNode,"click",c.hitch(this,function(a){a.stopPropagation();this.onMaxNodeClick()})));this.own(d(this.maxNode,"keydown",c.hitch(this,function(a){if(a.keyCode===e.ENTER||a.keyCode===e.SPACE)a.stopPropagation(),this.onMaxNodeClick()})))},createFrame:function(a){this.config.widgets&&1===this.config.widgets.length||!this.config.widgets?a=new p:(a=new r({label:a.label,
widgetManager:this.widgetManager}),m.after(a,"onFoldStateChanged",c.hitch(this,function(){var a=0;this._setFrameSize();f.forEach(this.getChildren(),function(b){b.folded||a++},this);f.forEach(this.getChildren(),function(b){b.foldEnable=b.folded||1!==a?!0:!1},this)})));return a},onFoldableNodeClick:function(){this.inherited(arguments);"minimized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.minimizePanel(this);b.setAttr(this.maxNode,"aria-label",this.headerNls.maxWindow)},
onMaxNodeClick:function(){"maximized"===this.windowState?(b.setAttr(this.maxNode,"aria-label",this.headerNls.maxWindow),this.panelManager.normalizePanel(this)):(b.setAttr(this.maxNode,"aria-label",this.headerNls.restoreWindow),this.panelManager.maximizePanel(this),this.folded=!1,b.removeClass(this.foldableNode,"folded"),b.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow))},moveTitle:function(){this.isFull?this.folded?b.setStyle(this.domNode,{top:b.getMarginBox(jimuConfig.layoutId).h-
this.titleHeight+"px"}):b.setStyle(this.domNode,{top:"0px"}):b.setStyle(this.domNode,{top:this.position.top+"px"})}})});