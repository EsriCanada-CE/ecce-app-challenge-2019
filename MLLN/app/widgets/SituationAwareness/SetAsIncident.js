// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare jimu/BaseFeatureAction jimu/WidgetManager dojo/Deferred esri/tasks/query dojo/_base/lang dojo/dom-class".split(" "),function(g,h,k,l,m,f,e){return g(h,{map:null,iconFormat:"png",isFeatureSupported:function(b){return 1===b.features.length&&b.features[0].geometry?!0:!1},onExecute:function(b){return k.getInstance().triggerWidgetOpen(this.widgetId).then(f.hitch(this,function(a){var c=b.features[0];this._getFeatureGeometry(c,a).then(f.hitch(this,function(b){c.geometry=b;e.contains(a.panelContainer,
"loading")&&e.remove(a.panelContainer,"loading");a._setEventLocation({feature:c,type:"add"})}))}))},_getFeatureGeometry:function(b,a){var c=new l;if(b&&b.getSourceLayer){var d=b.getSourceLayer();d.queryFeatures&&d.objectIdField&&d.getMaxAllowableOffset&&0<d.getMaxAllowableOffset()&&b.attributes.hasOwnProperty(d.objectIdField)?(e.add(a.panelContainer,"loading"),a=new m,a.returnGeometry=!0,a.maxAllowableOffset=0,a.objectIds=[b.attributes[d.objectIdField]],a.outSpatialReference=this.map.spatialReference,
d.queryFeatures(a).then(function(a){a&&a.features&&a.features[0]&&a.features[0].geometry?c.resolve(a.features[0].geometry):c.resolve(b.geometry)},function(a){console.log(a);c.resolve(b.geometry)})):c.resolve(b.geometry)}else c.resolve(b.geometry);return c}})});