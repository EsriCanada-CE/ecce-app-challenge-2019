// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define(["dojo/_base/lang","../utils","jimu/utils"],function(f,h,g){var d={stringFieldType:"esriFieldTypeString",oidFieldType:"esriFieldTypeOID",dateFieldType:"esriFieldTypeDate",numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],geometryFieldType:"esriFieldTypeGeometry",getFieldInfo:function(a,b){var c=null;b=b.fields;for(var e=0;e<b.length;e++)b[e].name===a&&(c=b[e]);return c},isGeometryType:function(a,b){return(a=d.getFieldInfo(a,b))?
a.type===d.geometryFieldType:!1},isStringType:function(a,b){return(a=d.getFieldInfo(a,b))?a.type===d.stringFieldType:!1},isNumberType:function(a,b,c){var e=f.clone(d.numberFieldTypes);c&&e.push(d.oidFieldType);return(a=d.getFieldInfo(a,b))?-1<e.indexOf(a.type):!1},isDateField:function(a,b){return(a=d.getFieldInfo(a,b))?a.type===d.dateFieldType:!1},getNotGeometryFields:function(a){if(a&&a.length)return a.filter(function(a){return a.type!==d.geometryFieldType})},getFieldAlias:function(a,b,c){a=d.getFieldInfo(a,
b);return this.getFieldAliasByFieldInfo(a,c)},getFieldInfosByFieldName:function(a,b){return a.map(function(a){a=d.getFieldInfo(a,b);return f.clone(a)}.bind(this))},updateOptions:function(a,b,c,e){b?(b=f.clone(b),a.removeOption(a.getOptions()),a.addOption(b)):b=[];!c&&0<b.length&&(c=b[0].value);c&&(a.set("value",c),e&&(b=a.getOptions(c))&&"undefined"!==typeof b.label&&a.set("title",b.label))},getNumberFields:function(a){if(a)return a.filter(function(a){return-1<this.numberFieldTypes.indexOf(a.type)}.bind(this))},
getFieldSelectOptions:function(a){if(a)return a.map(f.hitch(this,function(a){return{label:a.alias||a.name,value:a.name}}))},preProcessDefinition:function(a){if(!a||"Table"!==a.type)return a;var b=a.fields;if(b&&b.length)return b=b.filter(function(a){return!("STAT_COUNT"===a.name&&"STAT_COUNT"===a.alias&&"esriFieldTypeInteger"===a.type)}),a.fields=null,a.fields=b,a},getTemplateNameByMainDijitJson:function(a){if(a){var b;"gauge"===a.type?b=this._getTempNameForGaugeType(a):"chart"===a.type?b=this._getTempNameForChartType(a):
"number"===a.type&&(b="number");return b}},_getTempNameForGaugeType:function(a){var b;if(a=a.config.shape)return"curved"===a?b="gauge":"vertical"===a?b="vertical_gauge":"horizontal"===a&&(b="horizontal_gauge"),b},_getTempNameForChartType:function(a){var b=a.config;if(a=b.type){var c,e=b.stack,d=b.area,b=b.innerRadius;"pie"===a?c=b?"donut":"pie":"bar"===a||"column"===a?(c=a,"normal"===e?c="stacked_"+c:"percent"===e&&(c="percentage_stacked_"+c)):"line"===a&&(d?(c="area","normal"===e?c="stacked_"+c:
"percent"===e&&(c="percentage_stacked_"+c)):c="line");return c}},hasNumberFields:function(a){var b=!1;(a=a.fields)&&0<a.length&&(b=a.some(f.hitch(this,function(a){return 0<=this.numberFieldTypes.indexOf(a.type)})));return b},getClusterFields:function(a,b){if(b&&b.length)return a.filter(function(a){return-1<b.indexOf(a.name)});var c=[this.stringFieldType,this.dateFieldType,this.oidFieldType],c=c.concat(f.clone(this.numberFieldTypes));return a.filter(function(a){return 0<=c.indexOf(a.type)})},getValueFields:function(a,
b,c){a=a.filter(f.hitch(this,function(a){return 0<=this.numberFieldTypes.indexOf(a.type)}));b&&b.length&&c&&c.length&&(a=a.filter(function(a){return 0>c.indexOf(a.name)}));return a},getDefaultColorOfTheme:function(a){if(a){var b={bgColor:"#fff",textColor:"#000"};if(!this.appConfig)return b;"DashboardTheme"!==a.name||"default"!==a.styles[0]&&"style3"!==a.styles[0]?"DartTheme"===a.name&&(b.bgColor="#4c4c4c",b.textColor="#fff"):(b.bgColor="#222222",b.textColor="#fff");return b}},getLayerFromMap:function(a,
b){var c=null;b&&"undefined"!==typeof a&&(c=b.getLayer(a));return c},getCustomColorSelects:function(a,b,c){if((c=this.getCategoriesByFeatures(a,c))&&c.length){c=c.filter(function(a){return!!a||0===a});var e=this.isNumberType(a,b,!0),d=[],d=(a=g.getCodedValueListForCodedValueOrSubTypes(b,a))?f.clone(a):c.map(function(a){return{label:a,value:a}});return{selects:d,isCodedValue:!!a,numberType:e}}},getCategoriesByFeatures:function(a,b){var c=[];if(!b||!b.length)return c;b.forEach(f.hitch(this,function(b){b=
b.attributes[a];0>c.indexOf(b)&&c.push(b)}));return this.sortOrderCategories(c)},sortOrderCategories:function(a){Array.isArray(a)&&a.sort(function(a,c){"string"===typeof s&&(a=a.toLowerCase());"string"===typeof t&&(c=c.toLowerCase());g.isNumberOrNumberString(a)&&(a=Number(a));g.isNumberOrNumberString(c)&&(c=Number(c));return a<c?-1:a>c?1:0}.bind(this));return a},getNextColor:function(a,b){if(a&&a.length){var c=0;b&&(b=a.indexOf(b),-1<b&&(c=b+1,c>a.length-1&&(c=0)));return a[c]}}};f.mixin(h,d);return h});