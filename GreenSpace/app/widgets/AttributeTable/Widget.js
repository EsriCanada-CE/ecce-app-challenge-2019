// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dijit/layout/TabContainer":function(){define(["dojo/_base/lang","dojo/_base/declare","./_TabContainerBase","./TabController","./ScrollingTabController"],function(k,h,r,t,n){return h("dijit.layout.TabContainer",r,{useMenu:!0,useSlider:!0,controllerWidget:"",_makeController:function(h){var l=this.baseClass+"-tabs"+(this.doLayout?"":" dijitTabNoLayout");return new ("string"==typeof this.controllerWidget?k.getObject(this.controllerWidget):this.controllerWidget)({id:this.id+"_tablist",
ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,tabPosition:this.tabPosition,doLayout:this.doLayout,containerId:this.id,"class":l,nested:this.nested,useMenu:this.useMenu,useSlider:this.useSlider,tabStripClass:this.tabStrip?this.baseClass+(this.tabStrip?"":"No")+"Strip":null},h)},postMixInProperties:function(){this.inherited(arguments);this.controllerWidget||(this.controllerWidget="top"!=this.tabPosition&&"bottom"!=this.tabPosition||this.nested?t:n)}})})},"dijit/layout/_TabContainerBase":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style ./StackContainer ./utils ../_TemplatedMixin dojo/text!./templates/TabContainer.html".split(" "),
function(k,h,r,t,n,l,q,u){return k("dijit.layout._TabContainerBase",[n,q],{tabPosition:"top",baseClass:"dijitTabContainer",tabStrip:!1,nested:!1,templateString:u,postMixInProperties:function(){this.baseClass+=this.tabPosition.charAt(0).toUpperCase()+this.tabPosition.substr(1).replace(/-.*/,"");this.srcNodeRef&&t.set(this.srcNodeRef,"visibility","hidden");this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.tablist=this._makeController(this.tablistNode);this.doLayout||
h.add(this.domNode,"dijitTabContainerNoLayout");this.nested?(h.add(this.domNode,"dijitTabContainerNested"),h.add(this.tablist.containerNode,"dijitTabContainerTabListNested"),h.add(this.tablistSpacer,"dijitTabContainerSpacerNested"),h.add(this.containerNode,"dijitTabPaneWrapperNested")):h.add(this.domNode,"tabStrip-"+(this.tabStrip?"enabled":"disabled"))},_setupChild:function(k){h.add(k.domNode,"dijitTabPane");this.inherited(arguments)},removeChild:function(k){h.remove(k.domNode,"dijitTabPane");this.inherited(arguments)},
startup:function(){this._started||(this.tablist.startup(),this.inherited(arguments))},layout:function(){if(this._contentBox&&"undefined"!=typeof this._contentBox.l){var h=this.selectedChildWidget;if(this.doLayout){var k=this.tabPosition.replace(/-h/,"");this.tablist.region=k;k=[this.tablist,{domNode:this.tablistSpacer,region:k},{domNode:this.containerNode,region:"center"}];l.layoutChildren(this.domNode,this._contentBox,k);this._containerContentBox=l.marginBox2contentBox(this.containerNode,k[2]);h&&
h.resize&&h.resize(this._containerContentBox)}else{if(this.tablist.resize){k=this.tablist.domNode.style;k.width="0";var g=r.getContentBox(this.domNode).w;k.width="";this.tablist.resize({w:g})}h&&h.resize&&h.resize()}}},destroy:function(h){this.tablist&&this.tablist.destroy(h);this.inherited(arguments)}})})},"dijit/layout/StackContainer":function(){define("dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/has dojo/_base/lang dojo/on dojo/ready dojo/topic dojo/when ../registry ../_WidgetBase ./_LayoutWidget".split(" "),
function(k,h,r,t,n,l,q,u,v,w,g,b,f,e){l("dijit-legacy-requires")&&v(0,function(){require(["dijit/layout/StackController"])});r=r("dijit.layout.StackContainer",e,{doLayout:!0,persist:!1,baseClass:"dijitStackContainer",buildRendering:function(){this.inherited(arguments);t.add(this.domNode,"dijitLayoutContainer")},postCreate:function(){this.inherited(arguments);this.own(u(this.domNode,"keydown",q.hitch(this,"_onKeyDown")))},startup:function(){if(!this._started){var a=this.getChildren();k.forEach(a,this._setupChild,
this);this.persist?this.selectedChildWidget=b.byId(h(this.id+"_selectedChild")):k.some(a,function(a){a.selected&&(this.selectedChildWidget=a);return a.selected},this);var d=this.selectedChildWidget;!d&&a[0]&&(d=this.selectedChildWidget=a[0],d.selected=!0);w.publish(this.id+"-startup",{children:a,selected:d,textDir:this.textDir});this.inherited(arguments)}},resize:function(){if(!this._hasBeenShown){this._hasBeenShown=!0;var a=this.selectedChildWidget;a&&this._showChild(a)}this.inherited(arguments)},
_setupChild:function(a){var d=a.domNode,c=n.place("\x3cdiv role\x3d'tabpanel' class\x3d'"+this.baseClass+"ChildWrapper dijitHidden'\x3e",a.domNode,"replace"),b=a["aria-label"]||a.title||a.label;b&&c.setAttribute("aria-label",b);n.place(d,c);a._wrapper=c;this.inherited(arguments);"none"==d.style.display&&(d.style.display="block");a.domNode.removeAttribute("title")},addChild:function(a,d){this.inherited(arguments);this._started&&(w.publish(this.id+"-addChild",a,d),this.layout(),this.selectedChildWidget||
this.selectChild(a))},removeChild:function(a){var d=k.indexOf(this.getChildren(),a);this.inherited(arguments);n.destroy(a._wrapper);delete a._wrapper;this._started&&w.publish(this.id+"-removeChild",a);if(!this._descendantsBeingDestroyed){if(this.selectedChildWidget===a&&(this.selectedChildWidget=void 0,this._started)){var c=this.getChildren();c.length&&this.selectChild(c[Math.max(d-1,0)])}this._started&&this.layout()}},selectChild:function(a,d){var c;a=b.byId(a);this.selectedChildWidget!=a&&(c=this._transition(a,
this.selectedChildWidget,d),this._set("selectedChildWidget",a),w.publish(this.id+"-selectChild",a,this._focused),this.persist&&h(this.id+"_selectedChild",this.selectedChildWidget.id));return g(c||!0)},_transition:function(a,d){d&&this._hideChild(d);d=this._showChild(a);a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize());return d},_adjacent:function(a){var d=this.getChildren(),c=k.indexOf(d,this.selectedChildWidget),c=c+(a?1:d.length-1);return d[c%d.length]},
forward:function(){return this.selectChild(this._adjacent(!0),!0)},back:function(){return this.selectChild(this._adjacent(!1),!0)},_onKeyDown:function(a){w.publish(this.id+"-containerKeyDown",{e:a,page:this})},layout:function(){var a=this.selectedChildWidget;a&&a.resize&&(this.doLayout?a.resize(this._containerContentBox||this._contentBox):a.resize())},_showChild:function(a){var d=this.getChildren();a.isFirstChild=a==d[0];a.isLastChild=a==d[d.length-1];a._set("selected",!0);a._wrapper&&t.replace(a._wrapper,
"dijitVisible","dijitHidden");return a._onShow&&a._onShow()||!0},_hideChild:function(a){a._set("selected",!1);a._wrapper&&t.replace(a._wrapper,"dijitHidden","dijitVisible");a.onHide&&a.onHide()},closeChild:function(a){if(!a.onClose||a.onClose(this,a))this.removeChild(a),a.destroyRecursive()},destroyDescendants:function(a){this._descendantsBeingDestroyed=!0;this.selectedChildWidget=void 0;k.forEach(this.getChildren(),function(d){a||this.removeChild(d);d.destroyRecursive(a)},this);this._descendantsBeingDestroyed=
!1}});r.ChildWidgetProperties={selected:!1,disabled:!1,closable:!1,iconClass:"dijitNoIcon",showTitle:!0};q.extend(f,r.ChildWidgetProperties);return r})},"dijit/layout/TabController":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/has dojo/i18n dojo/_base/lang ./StackController ../registry ../Menu ../MenuItem dojo/text!./templates/_TabButton.html dojo/i18n!../nls/common".split(" "),function(k,h,r,t,n,l,q,u,v,w,g,b){b=k("dijit.layout._TabButton"+(n("dojo-bidi")?"_NoBidi":
""),u.StackButton,{baseClass:"dijitTab",cssStateNodes:{closeNode:"dijitTabCloseButton"},templateString:b,_setNameAttr:"focusNode",scrollOnFocus:!1,buildRendering:function(){this.inherited(arguments);h.setSelectable(this.containerNode,!1)},startup:function(){this.inherited(arguments);var b=this.domNode;this.defer(function(){b.className=b.className},1)},_setCloseButtonAttr:function(b){this._set("closeButton",b);t.toggle(this.domNode,"dijitClosable",b);this.closeNode.style.display=b?"":"none";b&&(b=
l.getLocalization("dijit","common"),this.closeNode&&r.set(this.closeNode,"title",b.itemClose))},_setDisabledAttr:function(b){this.inherited(arguments);if(this.closeNode)if(b)r.remove(this.closeNode,"title");else{var e=l.getLocalization("dijit","common");r.set(this.closeNode,"title",e.itemClose)}},_setLabelAttr:function(b){this.inherited(arguments);this.showLabel||this.params.title||(this.iconNode.alt=q.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});n("dojo-bidi")&&(b=k("dijit.layout._TabButton",
b,{_setLabelAttr:function(b){this.inherited(arguments);this.applyTextDir(this.iconNode,this.iconNode.alt)}}));k=k("dijit.layout.TabController",u,{baseClass:"dijitTabController",templateString:"\x3cdiv role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown:onkeydown'\x3e\x3c/div\x3e",tabPosition:"top",buttonWidget:b,buttonWidgetCloseClass:"dijitTabCloseButton",postCreate:function(){this.inherited(arguments);var b=new w({id:this.id+"_Menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,
textDir:this.textDir,targetNodeIds:[this.domNode],selector:function(a){return t.contains(a,"dijitClosable")&&!t.contains(a,"dijitTabDisabled")}});this.own(b);var e=l.getLocalization("dijit","common"),a=this;b.addChild(new g({label:e.itemClose,ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir,onClick:function(d){d=v.byNode(this.getParent().currentTarget);a.onCloseButtonClick(d.page)}}))}});k.TabButton=b;return k})},"dijit/layout/StackController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/topic ../focus ../registry ../_Widget ../_TemplatedMixin ../_Container ../form/ToggleButton dojo/touch".split(" "),
function(k,h,r,t,n,l,q,u,v,w,g,b,f,e){t=h("dijit.layout._StackButton",e,{tabIndex:"-1",closeButton:!1,_aria_attr:"aria-selected",buildRendering:function(a){this.inherited(arguments);(this.focusNode||this.domNode).setAttribute("role","tab")}});h=h("dijit.layout.StackController",[g,b,f],{baseClass:"dijitStackController",templateString:"\x3cspan role\x3d'tablist' data-dojo-attach-event\x3d'onkeydown'\x3e\x3c/span\x3e",containerId:"",buttonWidget:t,buttonWidgetCloseClass:"dijitStackCloseButton",pane2button:function(a){return w.byId(this.id+
"_"+a)},postCreate:function(){this.inherited(arguments);this.own(u.subscribe(this.containerId+"-startup",l.hitch(this,"onStartup")),u.subscribe(this.containerId+"-addChild",l.hitch(this,"onAddChild")),u.subscribe(this.containerId+"-removeChild",l.hitch(this,"onRemoveChild")),u.subscribe(this.containerId+"-selectChild",l.hitch(this,"onSelectChild")),u.subscribe(this.containerId+"-containerKeyDown",l.hitch(this,"onContainerKeyDown")));this.containerNode.dojoClick=!0;this.own(q(this.containerNode,"click",
l.hitch(this,function(a){var d=w.getEnclosingWidget(a.target);if(d!=this.containerNode&&!d.disabled&&d.page)for(a=a.target;a!==this.containerNode;a=a.parentNode)if(r.contains(a,this.buttonWidgetCloseClass)){this.onCloseButtonClick(d.page);break}else if(a==d.domNode){this.onButtonClick(d.page);break}})))},onStartup:function(a){this.textDir=a.textDir;k.forEach(a.children,this.onAddChild,this);if(a.selected)this.onSelectChild(a.selected);var d=w.byId(this.containerId).containerNode,c=l.hitch(this,"pane2button");
a={title:"label",showtitle:"showLabel",iconclass:"iconClass",closable:"closeButton",tooltip:"title",disabled:"disabled",textdir:"textdir"};var b=function(a,b){return q(d,"attrmodified-"+a,function(a){var d=c(a.detail&&a.detail.widget&&a.detail.widget.id);d&&d.set(b,a.detail.newValue)})},e;for(e in a)this.own(b(e,a[e]))},destroy:function(a){this.destroyDescendants(a);this.inherited(arguments)},onAddChild:function(a,d){var c=new (l.isString(this.buttonWidget)?l.getObject(this.buttonWidget):this.buttonWidget)({id:this.id+
"_"+a.id,name:this.id+"_"+a.id,label:a.title,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||this.textDir,showLabel:a.showTitle,iconClass:a.iconClass,closeButton:a.closable,title:a.tooltip,page:a});this.addChild(c,d);a.controlButton=c;if(!this._currentChild)this.onSelectChild(a);d=a._wrapper.getAttribute("aria-labelledby")?a._wrapper.getAttribute("aria-labelledby")+" "+c.id:c.id;a._wrapper.removeAttribute("aria-label");a._wrapper.setAttribute("aria-labelledby",
d)},onRemoveChild:function(a){this._currentChild===a&&(this._currentChild=null);var d=this.pane2button(a.id);d&&(this.removeChild(d),d.destroy());delete a.controlButton},onSelectChild:function(a){if(a){if(this._currentChild){var d=this.pane2button(this._currentChild.id);d.set("checked",!1);d.focusNode.setAttribute("tabIndex","-1")}d=this.pane2button(a.id);d.set("checked",!0);this._currentChild=a;d.focusNode.setAttribute("tabIndex","0");w.byId(this.containerId)}},onButtonClick:function(a){var d=this.pane2button(a.id);
v.focus(d.focusNode);this._currentChild&&this._currentChild.id===a.id&&d.set("checked",!0);w.byId(this.containerId).selectChild(a)},onCloseButtonClick:function(a){w.byId(this.containerId).closeChild(a);this._currentChild&&(a=this.pane2button(this._currentChild.id))&&v.focus(a.focusNode||a.domNode)},adjacent:function(a){this.isLeftToRight()||this.tabPosition&&!/top|bottom/.test(this.tabPosition)||(a=!a);var d=this.getChildren(),c=k.indexOf(d,this.pane2button(this._currentChild.id)),b=d[c],e;do c=(c+
(a?1:d.length-1))%d.length,e=d[c];while(e.disabled&&e!=b);return e},onkeydown:function(a,d){if(!this.disabled&&!a.altKey&&(d=null,a.ctrlKey||!a._djpage)){switch(a.keyCode){case n.LEFT_ARROW:case n.UP_ARROW:a._djpage||(d=!1);break;case n.PAGE_UP:a.ctrlKey&&(d=!1);break;case n.RIGHT_ARROW:case n.DOWN_ARROW:a._djpage||(d=!0);break;case n.PAGE_DOWN:a.ctrlKey&&(d=!0);break;case n.HOME:for(var c=this.getChildren(),b=0;b<c.length;b++){var e=c[b];if(!e.disabled){this.onButtonClick(e.page);break}}a.stopPropagation();
a.preventDefault();break;case n.END:c=this.getChildren();for(b=c.length-1;0<=b;b--)if(e=c[b],!e.disabled){this.onButtonClick(e.page);break}a.stopPropagation();a.preventDefault();break;case n.DELETE:case 87:this._currentChild.closable&&(a.keyCode==n.DELETE||a.ctrlKey)&&(this.onCloseButtonClick(this._currentChild),a.stopPropagation(),a.preventDefault());break;case n.TAB:a.ctrlKey&&(this.onButtonClick(this.adjacent(!a.shiftKey).page),a.stopPropagation(),a.preventDefault())}null!==d&&(this.onButtonClick(this.adjacent(d).page),
a.stopPropagation(),a.preventDefault())}},onContainerKeyDown:function(a){a.e._djpage=a.page;this.onkeydown(a.e)}});h.StackButton=t;return h})},"dijit/layout/ScrollingTabController":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/fx dojo/_base/lang dojo/on dojo/query dojo/sniff ../registry dojo/text!./templates/ScrollingTabController.html dojo/text!./templates/_ScrollingTabControllerButton.html ./TabController ./utils ../_WidgetsInTemplateMixin ../Menu ../MenuItem ../form/Button ../_HasDropDown dojo/NodeList-dom ../a11yclick".split(" "),
function(k,h,r,t,n,l,q,u,v,w,g,b,f,e,a,d,c,x,z,F){b=h("dijit.layout.ScrollingTabController",[e,d],{baseClass:"dijitTabController dijitScrollingTabController",templateString:b,useMenu:!0,useSlider:!0,tabStripClass:"",_minScroll:5,_setClassAttr:{node:"containerNode",type:"class"},buildRendering:function(){this.inherited(arguments);var a=this.domNode;this.scrollNode=this.tablistWrapper;this._initButtons();this.tabStripClass||(this.tabStripClass="dijitTabContainer"+this.tabPosition.charAt(0).toUpperCase()+
this.tabPosition.substr(1).replace(/-.*/,"")+"None",r.add(a,"tabStrip-disabled"));r.add(this.tablistWrapper,this.tabStripClass)},onStartup:function(){this.inherited(arguments);n.set(this.domNode,"visibility","");this._postStartup=!0;this.own(u(this.containerNode,"attrmodified-label, attrmodified-iconclass",q.hitch(this,function(a){this._dim&&this.resize(this._dim)})))},onAddChild:function(a,c){this.inherited(arguments);n.set(this.containerNode,"width",n.get(this.containerNode,"width")+200+"px")},
onRemoveChild:function(a,c){var d=this.pane2button(a.id);this._selectedTab===d.domNode&&(this._selectedTab=null);this.inherited(arguments)},_initButtons:function(){this._btnWidth=0;this._buttons=v("\x3e .tabStripButton",this.domNode).filter(function(a){if(this.useMenu&&a==this._menuBtn.domNode||this.useSlider&&(a==this._rightBtn.domNode||a==this._leftBtn.domNode))return this._btnWidth+=t.getMarginSize(a).w,!0;n.set(a,"display","none");return!1},this)},_getTabsWidth:function(){var a=this.getChildren();
if(a.length){var c=a[this.isLeftToRight()?0:a.length-1].domNode,a=a[this.isLeftToRight()?a.length-1:0].domNode;return a.offsetLeft+a.offsetWidth-c.offsetLeft}return 0},_enableBtn:function(a){var c=this._getTabsWidth();a=a||n.get(this.scrollNode,"width");return 0<c&&a<c},resize:function(c){this._dim=c;this.scrollNode.style.height="auto";var d=this._contentBox=a.marginBox2contentBox(this.domNode,{h:0,w:c.w});d.h=this.scrollNode.offsetHeight;t.setContentSize(this.domNode,d);d=this._enableBtn(this._contentBox.w);
this._buttons.style("display",d?"":"none");this._leftBtn.region="left";this._rightBtn.region="right";this._menuBtn.region=this.isLeftToRight()?"right":"left";a.layoutChildren(this.domNode,this._contentBox,[this._menuBtn,this._leftBtn,this._rightBtn,{domNode:this.scrollNode,region:"center"}]);this._selectedTab&&(this._anim&&"playing"==this._anim.status()&&this._anim.stop(),this.scrollNode.scrollLeft=this._convertToScrollLeft(this._getScrollForSelectedTab()));this._setButtonClass(this._getScroll());
this._postResize=!0;return{h:this._contentBox.h,w:c.w}},_getScroll:function(){return this.isLeftToRight()||8>w("ie")||w("trident")&&w("quirks")||w("webkit")?this.scrollNode.scrollLeft:n.get(this.containerNode,"width")-n.get(this.scrollNode,"width")+(w("trident")||w("edge")?-1:1)*this.scrollNode.scrollLeft},_convertToScrollLeft:function(a){if(this.isLeftToRight()||8>w("ie")||w("trident")&&w("quirks")||w("webkit"))return a;var c=n.get(this.containerNode,"width")-n.get(this.scrollNode,"width");return(w("trident")||
w("edge")?-1:1)*(a-c)},onSelectChild:function(a,c){var d=this.pane2button(a.id);if(d){var b=d.domNode;if(b!=this._selectedTab&&(this._selectedTab=b,this._postResize)){var e=this._getScroll();e>b.offsetLeft||e+n.get(this.scrollNode,"width")<b.offsetLeft+n.get(b,"width")?(b=this.createSmoothScroll(),c&&(b.onEnd=function(){d.focus()}),b.play()):c&&d.focus()}this.inherited(arguments)}},_getScrollBounds:function(){var a=this.getChildren(),c=n.get(this.scrollNode,"width"),d=n.get(this.containerNode,"width")-
c,b=this._getTabsWidth();if(a.length&&b>c)return{min:this.isLeftToRight()?0:a[a.length-1].domNode.offsetLeft,max:this.isLeftToRight()?a[a.length-1].domNode.offsetLeft+a[a.length-1].domNode.offsetWidth-c:d};a=this.isLeftToRight()?0:d;return{min:a,max:a}},_getScrollForSelectedTab:function(){var a=this._selectedTab,c=n.get(this.scrollNode,"width"),d=this._getScrollBounds(),a=a.offsetLeft+n.get(a,"width")/2-c/2;return a=Math.min(Math.max(a,d.min),d.max)},createSmoothScroll:function(a){if(0<arguments.length){var c=
this._getScrollBounds();a=Math.min(Math.max(a,c.min),c.max)}else a=this._getScrollForSelectedTab();this._anim&&"playing"==this._anim.status()&&this._anim.stop();var d=this,b=this.scrollNode,e=new l.Animation({beforeBegin:function(){this.curve&&delete this.curve;var c=b.scrollLeft,f=d._convertToScrollLeft(a);e.curve=new l._Line(c,f)},onAnimate:function(a){b.scrollLeft=a}});this._anim=e;this._setButtonClass(a);return e},_getBtnNode:function(a){for(a=a.target;a&&!r.contains(a,"tabStripButton");)a=a.parentNode;
return a},doSlideRight:function(a){this.doSlide(1,this._getBtnNode(a))},doSlideLeft:function(a){this.doSlide(-1,this._getBtnNode(a))},doSlide:function(a,c){c&&r.contains(c,"dijitTabDisabled")||(a*=.75*n.get(this.scrollNode,"width"),a=this._getScroll()+a,this._setButtonClass(a),this.createSmoothScroll(a).play())},_setButtonClass:function(a){var c=this._getScrollBounds();this._leftBtn.set("disabled",a<=c.min);this._rightBtn.set("disabled",a>=c.max)}});f=h("dijit.layout._ScrollingTabControllerButtonMixin",
null,{baseClass:"dijitTab tabStripButton",templateString:f,tabIndex:"",isFocusable:function(){return!1}});h("dijit.layout._ScrollingTabControllerButton",[z,f]);h("dijit.layout._ScrollingTabControllerMenuButton",[z,F,f],{containerId:"",tabIndex:"-1",isLoaded:function(){return!1},loadDropDown:function(a){this.dropDown=new c({id:this.containerId+"_menu",ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,textDir:this.textDir});var d=g.byId(this.containerId);k.forEach(d.getChildren(),function(a){var c=
new x({id:a.id+"_stcMi",label:a.title,iconClass:a.iconClass,disabled:a.disabled,ownerDocument:this.ownerDocument,dir:a.dir,lang:a.lang,textDir:a.textDir||d.textDir,onClick:function(){d.selectChild(a)}});this.dropDown.addChild(c)},this);a()},closeDropDown:function(a){this.inherited(arguments);this.dropDown&&(this._popupStateNode.removeAttribute("aria-owns"),this.dropDown.destroyRecursive(),delete this.dropDown)}});return b})},"widgets/AttributeTable/_ResourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all esri/lang jimu/portalUrlUtils ./table/_FeatureTable ./utils jimu/LayerInfos/LayerInfos".split(" "),
function(k,h,r,t,n,l,q,u,v,w){return k(null,{_activeLayerInfoId:null,_activeRelationshipKey:null,nls:null,config:null,map:null,_delayedLayerInfos:[],_layerInfosFromMap:[],featureTableSet:{},relationshipsSet:{},relationshipTableSet:{},currentRelationshipKey:null,relationshipInfoMapping:{},constructor:function(g){this.map=g&&g.map;this.nls=g&&g.nls;this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};this.relationshipsSet={};this.relationshipTableSet={};this.currentRelationshipKey=
null;this.relationshipInfoMapping={}},setConfig:function(g){this.config=h.clone(g||{})},setMap:function(g){this.map=g},updateLayerInfoResources:function(g){var b=new t;v.readConfigLayerInfosFromMap(this.map,!1,!0).then(h.hitch(this,function(f){this._layerInfosFromMap=f;this._processDelayedLayerInfos();g&&(0===this.config.layerInfos.length||this.config.syncWithLayers?(f=v.getConfigInfosFromLayerInfos(f),this.config.layerInfos=r.filter(f,function(b){return b.show})):this.config.layerInfos=r.filter(h.delegate(this.config.layerInfos),
h.hitch(this,function(b){var a=this._getLayerInfoById(b.id);return b.show&&a&&(b.name=a.name||a.title)})));b.resolve()}),function(f){b.reject(f)});return b},isEmpty:function(){return this.config&&this.config.layerInfos&&0>=this.config.layerInfos.length},getConfigInfos:function(){return h.clone(this.config.layerInfos)},addLayerInfo:function(g){0===this._layerInfosFromMap.length?this._delayedLayerInfos.push(g):0<this._layerInfosFromMap.length&&!this._getLayerInfoById(g.id)&&this._layerInfosFromMap.push(g)},
addConfigInfo:function(g){this._getConfigInfoById(g.id)||(g=v.getConfigInfoFromLayerInfo(g),this.config.layerInfos.push({id:g.id,name:g.name,layer:{url:g.layer.url,fields:g.layer.fields}}))},removeLayerInfo:function(g){g=this._getLayerInfoById(g);g=this._layerInfosFromMap.indexOf(g);this._layerInfosFromMap.splice(g,1)},removeConfigInfo:function(g){if(h.getObject("config.layerInfos",!1,this))for(var b=this.config.layerInfos.length,f=0;f<b;f++)if(this.config.layerInfos[f].id===g){this.featureTableSet[g]&&
(this.featureTableSet[g].destroy(),delete this.featureTableSet[g]);this.config.layerInfos.splice(f,1);break}},getQueryTable:function(g,b,f,e){var a=new t;this._activeLayerInfoId=g;this.featureTableSet[g]?a.resolve({isSupportQuery:!0,table:this.featureTableSet[g]}):this._getQueryTableInfo(g).then(h.hitch(this,function(d){if(d){var c=d.layerInfo,x=d.layerObject;d=d.tableInfo;if(this.featureTableSet[g])a.resolve({isSupportQuery:d.isSupportQuery,table:this.featureTableSet[g]});else if(h.getObject("isSupportQuery",
!1,d)){var z=this._getConfigInfoById(g);z||(this.addConfigInfo(c),z=this._getConfigInfoById(g));var F=h.getObject("layer.fields",!1,z),x=x&&x.fields,x=v.arcade.appendArcadeExpressionsToFields(x,c);z.layer.fields=this._clipValidFields(F,x);c=new u({map:this.map,matchingMap:b,hideExportButton:f,allowTextSelection:e,layerInfo:c,configedInfo:z,nls:this.nls});this.featureTableSet[g]=c;a.resolve({isSupportQuery:d.isSupportQuery,table:c})}else a.resolve({isSupportQuery:!1})}else a.resolve(null)}),function(d){a.reject(d)});
return a},getRelationTable:function(g,b,f,e,a){var d=new t,c=this.relationshipsSet[b];this._activeRelationshipKey=b;if(c){var x=this._getLayerInfoById(g);g=this.getRelationShipInfo(c);this.getQueryTable(g.id,f,e,a).then(h.hitch(this,function(a){if(a&&a.table){var b=a.table;b.set("relatedOriginalInfo",x);b.set("relationship",c)}d.resolve(a)}),h.hitch(function(){d.resolve(null)}))}else d.resolve(null);return d},removeRelationTable:function(g){this.relationshipTableSet[g]&&(this.relationshipTableSet[g].destroy(),
this.relationshipTableSet[g]=null)},getCurrentTable:function(g){return this.featureTableSet[g]||this.relationshipTableSet[g]},collectRelationShips:function(g,b){this._collectRelationShips(g,g.layerObject,b)},getConfigInfoById:function(g){return this._getConfigInfoById(g)},getLayerInfoById:function(g){return this._getLayerInfoById(g)},getVisivleLayerInfoIndexById:function(g){return this._getVisivleLayerInfoIndexById(g)},getRelationshipsByInfoId:function(g){var b=[],f;for(f in this.relationshipsSet){var e=
this.relationshipsSet[f];e._layerInfoId===g&&b.push(e)}return b},getRelationShipInfo:function(g){var b;if(g)for(relKey in this.relationshipInfoMapping)g._relKey===relKey&&(b=this.relationshipInfoMapping[relKey]);return b},empty:function(){this._delayedLayerInfos=[];this._layerInfosFromMap=[];this.featureTableSet={};for(var g in this.relationshipsSet)this._removeRelationShipInfo(this.relationshipsSet[g]);this.relationshipsSet={};this.relationshipTableSet={};this.nls=this.map=this.config=this.currentRelationshipKey=
null},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(r.forEach(this._delayedLayerInfos,h.hitch(this,function(g){!this._getLayerInfoById(g&&g.id)&&this.map&&this.map.getLayer(g.id)&&this._layerInfosFromMap.push(g)})),this._delayedLayerInfos=[])},_getLayerInfoById:function(g){for(var b=0,f=this._layerInfosFromMap.length;b<f;b++)if(this._layerInfosFromMap[b]&&this._layerInfosFromMap[b].id===g)return this._layerInfosFromMap[b]},_getVisivleLayerInfoIndexById:function(g){for(var b=
-1,f=0,e=this._layerInfosFromMap.length;f<e;f++)if(this._layerInfosFromMap[f]&&this._layerInfosFromMap[f].isShowInMap()&&(b++,this._layerInfosFromMap[f].id===g))return b},_getConfigInfoById:function(g){if(!h.getObject("layerInfos.length",!1,this.config))return null;for(var b=0,f=this.config.layerInfos.length;b<f;b++){var e=this.config.layerInfos[b];if(e&&e.id===g)return e}return null},_getQueryTableInfo:function(g){var b=new t,f=this._getLayerInfoById(g);if(f){var e=[],a=f.getUrl();e.push(f.getLayerObject());
e.push(f.getSupportTableInfo());a&&e.push(f.getRelatedTableInfoArray());n(e).then(h.hitch(this,function(d){if(this._activeLayerInfoId===g&&d){var c=d[0],e=d[1];d=a?d[2]:[];l.isDefined(d)&&l.isDefined(c)&&0<d.length&&this._collectRelationShips(f,c,d);b.resolve({layerInfo:f,layerObject:c,tableInfo:e})}else b.resolve(null)}),function(a){b.reject(a)})}else console.error("no activeLayerInfo!"),b.reject(Error());return b},_collectRelationShips:function(g,b,f){var e=b.relationships;if(e&&0<e.length&&b&&
b.url){var a=b.url.split("/");r.forEach(e,h.hitch(this,function(d){a[a.length-1]=d.relatedTableId;var c=a.join("/"),e=r.filter(f,h.hitch(this,function(a){a=a.getUrl();return l.isDefined(a)&&l.isDefined(c)&&q.removeProtocol(a.toString().toLowerCase())===q.removeProtocol(c.toString().toLowerCase())})),z=g.id+"_"+d.name+"_"+d.id;d._relKey=z;d._layerInfoId=g.id;e&&0<e.length&&this._setRelationShipInfo(d,e[0]);this.relationshipsSet[z]||(this.relationshipsSet[z]=d,this.relationshipsSet[z].objectIdField=
b.objectIdField)}))}},_setRelationShipInfo:function(g,b){g&&"_relKey"in g&&(this.relationshipInfoMapping[g._relKey]=b)},_removeRelationShipInfo:function(g){if(g&&"_relKey"in g)for(relKey in this.relationshipInfoMapping)g._relKey===relKey&&delete this.relationshipInfoMapping[relKey]},_getLayerInfoLabel:function(g){return g.name||g.title},_getLayerInfoId:function(g){return g&&g.id||""},_clipValidFields:function(g,b){if(!g||!g.length)return b||[];if(!b||!b.length)return g;for(var f=[],e=[],a=0,d=b.length;a<
d;a++){for(var c=b[a],x=0,z=g.length;x<z;x++){var F=g[x];if(F.name===c.name)break}x===z&&e.push(c)}a=0;for(d=g.length;a<d;a++)for(F=g[a],x=0,z=b.length;x<z;x++)if(c=b[x],c.name===F.name){f.push(F);break}f=f.concat(e);0===f.length&&0<g.length&&(g=h.clone(b),r.forEach(g,h.hitch(this,function(a){"esriFieldTypeGeometry"!==a.type&&(a.show=!0,f.push(a))})));return f}})})},"widgets/AttributeTable/table/_FeatureTable":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase jimu/dijit/Message jimu/dijit/Filter dgrid/OnDemandGrid ../dgrid/Selection dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dgrid/extensions/ColumnReorder dijit/Menu dijit/MenuItem dijit/Toolbar dijit/form/Button dijit/DropDownMenu dijit/form/ToggleButton dijit/form/DropDownButton dojo/Deferred dojo/when dojo/Evented dojo/touch dojo/store/Memory esri/config esri/lang esri/request esri/tasks/RelationParameters esri/tasks/RelationshipQuery esri/layers/FeatureLayer esri/tasks/QueryTask esri/tasks/query esri/tasks/ProjectParameters esri/geometry/Multipoint esri/geometry/geometryEngine esri/geometry/normalizeUtils esri/IdentityManager dojo/_base/lang dojo/on dojo/aspect dojo/_base/array jimu/dijit/LoadingIndicator jimu/dijit/FieldStatistics jimu/dijit/Popup jimu/dijit/CheckBox jimu/SelectionManager jimu/CSVUtils jimu/utils ../utils dojo/query dojo/string".split(" "),
function(k,h,r,t,n,l,q,u,v,w,g,b,f,e,a,d,c,x,z,F,J,G,K,D,p,B,E,M,H,I,Q,R,S,T,U,m,C,V,A,W,X,Y,Z,aa,ba,L,N,O,ca){return k([r,F],{baseClass:"jimu-widget-attributetable-feature-table",_defaultFeatureCount:2E3,_defaultBatchCount:25,_batchCount:0,_filterObj:null,_currentDef:null,_requestStatus:"initial",map:null,matchingMap:!1,layerInfo:null,configedInfo:null,footerHeight:25,layer:null,loading:null,grid:null,footer:null,selectedRowsLabel:null,selectionRows:null,nls:null,_dblClickResult:null,actived:!1,
showSelected:!1,tableCreated:!1,_relatedQuery:!1,_relatedQueryIds:null,_selectionHandles:null,_selectionResults:null,_normalizedExtent:null,constructor:function(a){a=a||{};this.set("map",a.map||null);this.set("matchingMap",!!a.matchingMap);this.set("layerInfo",a.layerInfo||null);this.set("layer",a.layer||null);this.set("configedInfo",a.configedInfo||null);this.set("relatedOriginalInfo",a.relatedOriginalInfo||null);this.set("relationship",a.relationship||null);this.set("syncSelection",!!a.syncSelection||
!0)},postCreate:function(){this.inherited(arguments);this._relatedQueryIds=[];this.createToolbar();this.loading=new W;this.loading.placeAt(this.domNode);this.selectionManager=aa.getInstance();this._selectionResults=[];this.selectionRows=[];this._normalizedExtent=null;h.setAttr(this.domNode,"data-layerinfoid",m.getObject("layerInfo.id",!1,this));this.get("map")&&(this.own(C(this.map.root,J.release,m.hitch(this,function(){this._clickMap=!0}))),this.own(C(this.map,"extent-change",m.hitch(this,"_onExtentChange"))));
this.own(C(window,"resize",m.hitch(this,this._resize)))},startup:function(){this.inherited(arguments);this.toolbarHeight=parseInt(h.getStyle(this.toolbar.domNode,"height"),10)||0},setLayerDefinition:function(a){this._layerDefinition=a},getLayerDefinition:function(){return this._getLayerDifinition()},getFilterableFields:function(){if(this._layerDefinition&&this.configedInfo){var a=m.clone(this._layerDefinition);return this._getFilterableFields(a.fields,this.configedInfo.layer.fields)}return[]},getFilterObj:function(){return this._filterObj},
setFilterObj:function(a){this._filterObj=a},showRefreshing:function(a){a?this.loading.show():this.loading.hide()},active:function(){this.actived=!0},deactive:function(){this.actived=!1},cancelThread:function(){"fulfilled"!==this._requestStatus&&this._currentDef&&(this._currentDef.cancel({canceledBySelf:!0}),this._requestStatus="canceled")},isCanceled:function(){return"canceled"===this._requestStatus},createToolbar:function(){var y=new f({},h.create("div")),p=new a;this.showSelectedRecordsMenuItem=
new b({label:this.nls.showSelectedRecords,iconClass:"esriAttributeTableSelectPageImage",onClick:m.hitch(this,this.toggleSelectedRecords)});p.addChild(this.showSelectedRecordsMenuItem);this.showRelatedRecordsMenuItem=new b({label:this.nls.showRelatedRecords,iconClass:"esriAttributeTableSelectAllImage",onClick:m.hitch(this,this.onShowRelatedRecordsClick)});p.addChild(this.showRelatedRecordsMenuItem);this.filterMenuItem=new b({label:this.nls.filter,iconClass:"esriAttributeTableFilterImage",onClick:m.hitch(this,
this.onFilterMenuItemClick)});p.addChild(this.filterMenuItem);this.toggleColumnsMenuItem=new b({label:this.nls.columns,iconClass:"esriAttributeTableColumnsImage",onClick:m.hitch(this,this.onToggleColumnsClick)});p.addChild(this.toggleColumnsMenuItem);this.hideExportButton||(this.exportCSVMenuItem=new b({label:this.nls.exportFiles,showLabel:!0,iconClass:"esriAttributeTableExportImage",onClick:m.hitch(this,this.onExportCSVClick)}),p.addChild(this.exportCSVMenuItem));this.selectionMenu=new c({label:this.nls.options,
iconClass:"esriAttributeTableOptionsImage",dropDown:p});y.addChild(this.selectionMenu);this.matchingCheckBox=new d({checked:this.matchingMap?!0:!1,showLabel:!0,label:this.nls.filterByExtent,onChange:m.hitch(this,function(a){this.set("matchingMap",a);this._onMatchingCheckBoxChange(a)})});y.addChild(this.matchingCheckBox);this.zoomButton=new e({label:this.nls.zoomto,iconClass:"esriAttributeTableZoomImage",onClick:m.hitch(this,this.zoomTo)});y.addChild(this.zoomButton);this.clearSelectionButton=new e({label:this.nls.clearSelection,
iconClass:"esriAttributeTableClearImage",onClick:m.hitch(this,this.clearSelection,!0,!0)});y.addChild(this.clearSelectionButton);this.refreshButton=new e({label:this.nls.refresh,showLabel:!0,iconClass:"esriAttributeTableRefreshImage",onClick:m.hitch(this,this.refresh)});y.addChild(this.refreshButton);h.place(y.domNode,this.domNode);this.toolbar=y;this.own(C(this,"data-loaded,row-click,clear-selection",m.hitch(this,"changeToolbarStatus")))},startQuery:function(a){this.cancelThread();this._requestStatus=
"processing";this.loading.show();a&&a.length?this.queryByStoreObjectIds=a:(this._relatedQuery=!1,this._relatedQueryIds=[],this.queryByStoreObjectIds=null);this._currentDef=this._getLayerObject();this._currentDef.then(m.hitch(this,function(c){this.domNode&&(this.layer=c,(c=!this.layerInfo.isTable&&this.matchingMap&&this.map.extent||null)&&c.spatialReference&&c.spatialReference.isWebMercator()?(this._currentDef=T.normalizeCentralMeridian([c],null,m.hitch(this,function(a){return a[0]}))).then(m.hitch(this,
function(c){this._doQuery(c,a);this._normalizedExtent=c}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()})):this._doQuery(c,a))}),m.hitch(this,function(a){console.error(a);this.changeToolbarStatus();this.loading.hide()}))},queryRecordsByRelationship:function(a){var c=a&&a.layer,d=a&&a.selectedIds;a&&a.relationship&&this.set("relationship",a.relationship);a&&a.relatedOriginalInfo&&this.set("relatedOriginalInfo",a.relatedOriginalInfo);
var b=this.relationship;c&&b&&d&&0<d.length&&!L.isEqual(this._relatedQueryIds,d)&&m.getObject("relatedOriginalInfo.layerObject.url",!1,this)?(this.loading.show(),this._requestStatus="processing",this._relatedQuery=!0,this.matchingCheckBox.set("checked",!1),this.cancelThread(),this._currentDef=this._getLayerObject(),this._currentDef.then(m.hitch(this,function(a){if(this.domNode){this.layer=a;var e=[],y=this.layer;A.forEach(y.fields,function(a){(!D.isDefined(a.show)||!0===a.show||"esriFieldTypeOID"===
a.type||D.isDefined(y.objectIdField)&&a.name===y.objectIdField)&&e.push(a.name)});a=new E;a.objectIds=d;a.outFields=e.length?e:["*"];a.relationshipId=b.id;a.returnGeometry="esriGeometryPoint"===this.layer.geometryType;(this._currentDef=c.queryRelatedFeatures(a,function(a){return a})).then(m.hitch(this,function(a){if(this.domNode){var c={displayFieldName:b.objectIdField,fields:y.fields,features:[],fieldAliases:null},e={},f=function(a){var d=a.attributes[this.layer.objectIdField];e[d]||(e[d]=!0,c.features.push(a))},
p;for(p in a){var P=a[p];A.forEach(P&&P.features,f,this)}h.destroy(this.tipNode);0<c.features.length?(this.grid||(this._removeTable(),h.place(this.loading.domNode,this.domNode)),a=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),this.queryExecute(a,c.features.length,!1,c)):(this.tipNode=h.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e"),this._removeTable(),h.place(this.tipNode,this.domNode),h.place(this.loading.domNode,this.domNode));this._relatedQueryIds=d;this.emit("data-loaded");
this.loading.hide()}}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);h.destroy(this.tipNode);this.tipNode=h.toDom("\x3cdiv\x3e"+this.nls.noRelatedRecords+"\x3c/div\x3e");this._removeTable();h.place(this.tipNode,this.domNode);h.place(this.loading.domNode,this.domNode);this.loading.hide();this.changeToolbarStatus()}))}}),m.hitch(this,function(a){console.error(a);this.loading.hide();this.changeToolbarStatus()}))):this.loading.hide()},getSelectedRows:function(){return this.tableCreated?
this.selectionRows:[]},zoomTo:function(){this._zoomToSelected()},toggleSelectedRecords:function(){this._relatedQuery&&!this.showSelected&&0===this.getSelectedRows().length?(this._relatedQuery=!1,this._relatedQueryIds=[],this.layerInfo&&!this.layerInfo.isTable&&this.matchingCheckBox.set("checked",!0),this.startQuery(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):this.tableCreated&&(this.showSelected?
(this.showAllSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showSelectedRecords),this.showSelected=!1,this.emit("show-all-records",{layerInfoId:this.layerInfo.id})):(this.showSelectedRecords(),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords),this.showSelected=!0,this.emit("show-selected-records",{layerInfoId:this.layerInfo.id})))},onShowRelatedRecordsClick:function(){var a=this.getSelectedRows();0<a.length?this.emit("show-related-records",{layerInfoId:this.layerInfo.id,
objectIds:a}):this._getFeatureIds(this.layer&&this.layer.objectIdField,this.matchingMap&&this._normalizedExtent).then(m.hitch(this,function(a){console.log(a);this.emit("show-related-records",{layerInfoId:this.layerInfo.id,objectIds:a})}))},onFilterMenuItemClick:function(){this.showRefreshing(!0);this.getLayerDefinition().then(m.hitch(this,function(a){if(this.domNode){a=m.clone(a);var c=this.getFilterableFields();a.fields=c;var d=new n({noFilterTip:this.nls.noFilterTip,style:"width:100%;",featureLayerId:this.layerInfo.id,
runtime:!0}),c=this._getFilterPopupSize();this._filterPopup=new Y({titleLabel:this.nls.filter,width:c.w,height:c.h,content:d,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:m.hitch(this,function(){var a=d.toJson();a&&a.expr?(this.setFilterObj(a),this.clearSelection(!1),this.startQuery(),this._filterPopup.close(),this._filterPopup=null,this.emit("apply-filter",{layerInfoId:this.layerInfo.id,expr:a.expr})):new t({message:this.nls.setFilterTip})})},{label:this.nls.cancel}]});d.startup();h.addClass(this._filterPopup.domNode,
"widget-at-filter-popup");c=this.getFilterObj();d.build({url:this.layer.url,partsObj:c,layerDefinition:this.layer||a,featureLayerId:this.layer.id})}}),m.hitch(this,function(a){this.domNode&&console.error(a)})).always(m.hitch(this,function(){this.showRefreshing(!1)}));this.emit("show-filter",{layerInfoId:this.layerInfo.id})},_getFilterPopupSize:function(){var a={w:720,h:485};window.appInfo.isRunInMobile&&(a={w:window.innerWidth,h:window.innerHeight});return a},_resize:function(){if(this._filterPopup){var a=
this._getFilterPopupSize();this._filterPopup.resize(a)}},onToggleColumnsClick:function(){this.toggleColumns();this.emit("toggle-columns",{layerInfoId:this.layerInfo.id})},onExportCSVClick:function(){var a=this._getRichTextFields(),c=this._getExportCSVPopupMessage(a),d=new t({"class":this.baseClass+"-popup",message:c,titleLabel:this.nls.exportFiles,autoHeight:!0,buttons:[{label:this.nls.ok,onClick:m.hitch(this,function(){var b=c._check;this.exportToCSV(null,"undefined"===typeof b||b.checked?null:a);
d.close()})},{label:this.nls.cancel}]});this.emit("export-csv",{layerInfoId:this.layerInfo.id})},_getExportCSVPopupMessage:function(a){var c=document.createElement("div");c.className="message-wrapper";c.appendChild(document.createTextNode(this.nls.exportMessage));if(a.length){var d=document.createElement("div");d.className="input-row";var b=new Z({label:this.nls.keepRichTextLabel,checked:!0}),e=document.createElement("a");e.className="hint-button";e.href="#";e.role="button";e.appendChild(document.createTextNode(this.nls.whatsThis));
d.appendChild(b.domNode);d.appendChild(e);c.appendChild(d);c._check=b;this.own(C(e,"click",m.hitch(this,function(c){c.preventDefault();c={"class":this.baseClass+"-popup",message:this._getRichTextMessage(a)};window.appInfo.isRunInMobile||(c.width=500);new t(c)})))}return c},_getRichTextMessage:function(a){if(!a||a.hasOwnProperty("length")&&!a.length)return"";for(var c=document.createElement("div"),d="",b=0,e=a.length;b<e;b++)d+="\x3cmark\x3e"+a[b].fieldName+"\x3c/mark\x3e";a=""+("\x3cp\x3e"+ca.substitute(this.nls.richTextMessage.explanatoryText.line1,
{layerName:"\x3cstrong\x3e"+this.layer.name+"\x3c/strong\x3e"})+"\x3c/p\x3e");a=a+('\x3cdiv class\x3d"tags"\x3e'+d+"\x3c/div\x3e")+("\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line2+"\x3c/p\x3e\x3cp\x3e"+this.nls.richTextMessage.explanatoryText.line3+"\x3c/p\x3e\x3ch3\x3e"+this.nls.richTextMessage.example.label+'\x3c/h3\x3e\x3cdiv class\x3d"example-block"\x3e\x3cpre\x3e\x3cfont color\x3d"#31aacd"\x3eWeb AppBuilder\x3c/font\x3e for \x3cu\x3eArcGIS\x3c/u\x3e\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.first+
'\x3cpre\x3e\x26ltfont color\x3d"#31aacd"\x26gtWeb AppBuilder\x26lt/font\x26gt for \x26ltu\x26gtArcGIS\x26lt/u\x26gt\x3c/pre\x3e'+this.nls.richTextMessage.example.scenarios.second+"\x3cpre\x3eWeb AppBuilder for ArcGIS\x3c/pre\x3e\x3c/div\x3e");c.innerHTML=a;return c},_getRichTextFields:function(){var a=this.layerInfo&&this.layerInfo.getPopupInfo&&this.layerInfo.getPopupInfo(),a=a&&a.fieldInfos,c=[];if(a)for(var d=0,b=a.length;d<b;d++){var e=a[d];e.stringFieldOption&&"richtext"===e.stringFieldOption&&
c.push(e)}return c},onSelectionComplete:function(){var a=this.layer&&this.layer.getSelectedFeatures();a&&(0===a.length?this.clearSelection(!1,0<this._selectionResults.length):this._selectBySelf(a)||(this.clearSelection(!1),this._updateSelectRowsByFeatures(a)))},onSelectionClear:function(){this.clearSelection(!1,!0)},changeToolbarStatus:function(){if(this.tableCreated){var a=this.getSelectedRows();this.showSelected?this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords):this.showSelectedRecordsMenuItem.set("label",
this.nls.showSelectedRecords);this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.clearSelectionButton.set("disabled",!1)):(this.showSelectedRecordsMenuItem.set("disabled",!0),this.clearSelectionButton.set("disabled",!0));this._relatedQuery&&(this.showSelectedRecordsMenuItem.set("disabled",!1),this.tableCreated&&a&&0===a.length&&this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords));this.showRelatedRecordsMenuItem.set("disabled",
!0);if(this.layerInfo&&this.isSupportQueryToServer()&&this.layer&&this.layer.objectIdField){this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel();var c=this.layerInfo.getRelatedTableInfoArray();this._relatedDef=c;c.then(m.hitch(this,function(a){this.domNode&&this.tableCreated&&a&&0<a.length&&this.showRelatedRecordsMenuItem.set("disabled",!1)}))}this.tableCreated&&this.isSupportQueryToServer()&&!this._relatedQuery?this.filterMenuItem.set("disabled",!1):this.filterMenuItem.set("disabled",
!0);this.matchingCheckBox.set("disabled",!1);this.tableCreated?this.toggleColumnsMenuItem.set("disabled",!1):this.toggleColumnsMenuItem.set("disabled",!0);this.hideExportButton||(a&&0<a.length?this.exportCSVMenuItem.set("label",this.nls.exportSelected):this.exportCSVMenuItem.set("label",this.nls.exportAll),this.tableCreated?this.exportCSVMenuItem.set("disabled",!1):this.exportCSVMenuItem.set("disabled",!0));this.layerInfo.isShowInMap()?this.tableCreated&&a&&0<a.length?this.zoomButton.set("disabled",
!1):this.zoomButton.set("disabled",!0):this.zoomButton.set("disabled",!0);this.layerInfo.isTable&&(this.matchingCheckBox.set("disabled",!0),this.zoomButton.set("disabled",!0))}else this._relatedQuery?(this.showSelectedRecordsMenuItem.set("disabled",!1),this.showSelectedRecordsMenuItem.set("label",this.nls.showAllRecords)):this.showSelectedRecordsMenuItem.set("disabled",!0),this.showRelatedRecordsMenuItem.set("disabled",!0),this.matchingCheckBox.set("disabled",!0),this.filterMenuItem.set("disabled",
!0),this.toggleColumnsMenuItem.set("disabled",!0),this.hideExportButton||this.exportCSVMenuItem.set("disabled",!0),this.zoomButton.set("disabled",!0)},showSelectedRecords:function(){if(this.tableCreated){var a=this.layer.objectIdField,c=this.getSelectedRows();0<c.length&&this.grid&&(this.grid.store instanceof G?this.grid.set("query",m.hitch(this,function(d){return"number"===typeof d&&-1<c.indexOf(d)||-1<c.indexOf(d[a])?!0:!1})):this.grid.set("query",function(){return c}))}},showAllSelectedRecords:function(){if(this.tableCreated&&
this.showSelected){this.grid.set("query",{});var a=this.getSelectedRows();this._updateSelectRowsByIds(a)}},clearSelection:function(a,c){this.tableCreated&&(this.grid.clearSelection(),this.selectionRows=[],a&&this.grid.set("query",{}),c&&(this._selectionResults=[],this.layer&&0<this.layer.getSelectedFeatures().length&&this.selectionManager.clearSelection(this.layer)),this._closePopup(),this.setSelectedNumber(),this.showSelected=!1,this.emit("clear-selection"))},refresh:function(){this.grid&&this.grid.clearSelection();
this._relatedQuery||this.startQuery();this.emit("refresh",{layerInfoId:this.layerInfo.id})},exportToCSV:function(a,c){this.layerInfo&&this.layer&&this.tableCreated&&this.getSelectedRowsData().then(m.hitch(this,function(d){var b=this.layer.objectIdField,e=[],f=this.layer.fullExtent.spatialReference.equals(this.map.extent.spatialReference),p=this._hasArcadeExpressionFields();if(f){var y=A.map(this._getTableSelectedIds(),m.hitch(this,function(a){for(var c=0,e=d.length;c<e;c++)if(d[c]&&d[c][b]===a)return d[c];
return{}}))||[];0===y.length&&this.isSelectionMode()&&y.push({});e=y;0===y.length&&this.grid.store instanceof G&&(e=m.clone(this.grid.store.data));e.length&&this._appendXY(e)}var y={},g=this.getOutFields(!!e.length);y.datas=e;y.fromClient=!1;y.withGeometry="esriGeometryPoint"===this.layer.geometryType;y.outFields=g;y.formatNumber=!1;y.formatDate=!0;y.formatCodedValue=!0;y.popupInfo=this.layerInfo.getPopupInfo();y.objectIds=!f&&this._getExportObjectIds();y.outSpatialReference=!f&&m.clone(this.layer.fullExtent.spatialReference);
y.richTextFieldsToClear=c;p&&(y.arcadeExpressions={expressionInfos:this.layerInfo.getPopupInfo().expressionInfos,layerDefinition:L.getFeatureLayerDefinition(this.layer)});return ba.exportCSVFromFeatureLayer(a||this.configedInfo.name,this.layer,y)}))},toggleColumns:function(){this.tableCreated&&this.grid._toggleColumnHiderMenu()},changeHeight:function(a){this.grid&&0<=a-this.toolbarHeight-this.footerHeight&&h.setStyle(this.grid.domNode,"height",a-this.toolbarHeight-this.footerHeight+"px")},isSupportQueryToServer:function(){var a=
this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,c=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return this.layer&&this.layer.url&&this.configedInfo.layer.url&&!a&&!c},isSupportQueryOnClient:function(){var a=this.layer&&"esri.layers.CSVLayer"===this.layer.declaredClass,c=this.layer&&"esri.layers.StreamLayer"===this.layer.declaredClass;return!(this.layer&&this.layer.url&&this.configedInfo.layer.url)||a||c},destroy:function(){this._destroyed||(this.layer=this.configedInfo=
this.layerInfo=null,this._selectionHandles&&A.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()}),this._closePopup(),this._filterPopup&&this._filterPopup.domNode&&(this._filterPopup.close(),this._filterPopup=null),this._dblClickResult=null,this.grid&&this.grid.destroy(),this.relationship=this.nls=this.map=null,this._currentDef&&!this._currentDef.isFulfilled()&&this._currentDef.cancel({canceledBySelf:!0}),this._relatedDef&&!this._relatedDef.isFulfilled()&&this._relatedDef.cancel({canceledBySelf:!0}),
this.inherited(arguments))},_selectBySelf:function(a){a=a||[];if(a.length!==this._selectionResults.length)return!1;var c=this.layer.objectIdField;return A.every(this._selectionResults,function(d){return a.some(function(a){return d.attributes[c]===a.attributes[c]})})},_updateSelectRowsByFeatures:function(a){var c=A.map(a,m.hitch(this,function(a){return a.attributes[this.layer.objectIdField]}));this._updateSelectRowsByIds(c);this._selectionResults=a},_updateSelectRowsByIds:function(a){this.grid&&this.tableCreated&&
(this.selectionRows=a,A.forEach(a,m.hitch(this,function(a){this.grid.select(a)})),this.setSelectedNumber(),this.changeToolbarStatus())},_removeTable:function(){this.grid&&this.grid.domNode&&(this.grid.destroy(),this.grid=null);this.footer&&(h.destroy(this.footer),this.selectedRowsLabel=this.footer=null);this.tableCreated=!1},_onMatchingCheckBoxChange:function(a){this.tableCreated&&!this._relatedQuery&&(this.cancelThread(),this.queryByStoreObjectIds=null,this.startQuery());if("fulfilled"===this._requestStatus&&
this.tableCreated&&this._relatedQuery)if(a)this.queryByStoreObjectIds=A.map(this.grid.store.data,m.hitch(this,function(a){return a[this.layer.objectIdField]})),this.startQuery(this.queryByStoreObjectIds);else{var c=this._relatedQueryIds;this._relatedQueryIds=[];this.queryRecordsByRelationship({layer:this.relatedOriginalInfo.layerObject,selectedIds:c})}a||(this._currentExtent=null)},_closePopup:function(){var a=this.map.infoWindow.getSelectedFeature(),c=a&&this._dblClickResult&&a===this._dblClickResult,
a=a&&a._layer===this.layer;this.domNode&&(c||a)&&(this.map.infoWindow.hide(),this._dblClickResult=null)},_getLayerObject:function(){function a(a){this._selectionHandles&&A.forEach(this._selectionHandles,function(a){a&&a.remove&&a.remove()});this._selectionHandles=[];this._selectionHandles.push(C(a,"selection-complete",m.hitch(this,"onSelectionComplete")));this._selectionHandles.push(C(a,"selection-clear",m.hitch(this,"onSelectionClear")))}return(this._currentDef=this.layerInfo.getLayerObject()).then(m.hitch(this,
function(c){var d=new x;"esri.layers.ArcGISImageServiceLayer"===c.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===c.declaredClass?(c=new M(c.url),this.own(C(c,"load",m.hitch(this,function(c){m.hitch(this,a)(c.layer);d.resolve(c.layer)})))):(m.hitch(this,a)(c),d.resolve(c));return d}))},_getLayerDifinition:function(){return this._layerDefinition?z(m.clone(this._layerDefinition)):p({url:this.layer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(m.hitch(this,function(a){this.setLayerDefinition(a);
return this.getLayerDefinition()}))},_getFilterableFields:function(a,c){return A.filter(a,function(a){return A.some(c,function(c){return a.name===c.name&&(c.show||!D.isDefined(c.show))&&m.mixin(a,c)})})},_getExportObjectIds:function(){var a=this._getTableSelectedIds()||[];if(0===a.length&&this.grid.store instanceof G){var c=this.layer.objectIdField;this.grid.store.query(function(d){a.push(d[c])})}return a},_doQuery:function(a,c){if(this.layer){var d=this.layer.objectIdField;this.isSupportQueryToServer()?
this._queryToServer(a,d,c):this.isSupportQueryOnClient()&&this._queryOnClient(a,d,c)}},_queryOnClient:function(a,c,d){var b={};b.features="esri.layers.StreamLayer"===this.layer.declaredClass?this.layer.getLatestObservations():A.filter(this.layer.graphics,m.hitch(this,function(a){return!a.wabIsTemp}));d&&0<d.length&&(b.features=A.filter(b.features,function(a){return-1<d.indexOf(a.attributes[this.layer.objectIdField])},this));var e=this.layer.fields,f=this.configedInfo.layer.fields;b.fields=f?A.filter(f,
m.hitch(this,function(a){D.isDefined(a.show)||(a.show=!0);a.name!==c||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);for(var d=0,b=e.length;d<b;d++)e[d].name!==a.name||a.type||(a.type=e[d].type);return a.show||a._pk})):A.filter(e,m.hitch(this,function(a){D.isDefined(a.show)||(a.show=!0);a.name!==c||"esriFieldTypeOID"!==a.type&&"esriFieldTypeInteger"!==a.type||(a._pk=!0);return a.show||a._pk}));for(var f=[],p=b.features.length,g=0;g<p;g++)b&&b.features&&b.features[g]&&b.features[g].geometry&&
f.push(b.features[g].geometry);a&&K.defaults.geometryService&&0<f.length?a.spatialReference.equals(f[0].spatialReference)?(b.features=A.filter(b.features,m.hitch(this,function(c){if(c&&c.geometry)return S.intersects(a,c.geometry)})),this.queryExecute(b.fields,b.features.length,!1,b,a)):(p=new B,p.geometries1=f,p.geometries2=[a],p.relation=B.SPATIAL_REL_INTERSECTION,(this._currentDef=K.defaults.geometryService.relation(p,m.hitch(this,function(a){return a}))).then(m.hitch(this,function(c,d){for(var b=
d.length,e=[],f=0;f<b;f++)e.push(c.features[d[f].geometry1Index]);c.features=e;this.queryExecute(c.fields,c.features.length,!1,c,a)},b),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()}))):this.queryExecute(b.fields,b.features.length,!1,b,a)},_queryToServer:function(a,c,d){this._getFeatureCount(a,d).then(m.hitch(this,function(b){if(this.domNode)if(d)this._queryFeatureLayer(a,c,b,!1,d);else{var e=this.layer,f=D.isDefined(e.maxRecordCount)?
e.maxRecordCount:1E3;this._batchCount=Math.min(f,this._defaultBatchCount);if(b<=f||!this.layer.objectIdField)this._queryFeatureLayer(a,c,b,!1);else{var p=this._getOutFieldsFromLayerInfos(c),g={fields:this.layer.fields};this.layer._recordCounts=b;e.advancedQueryCapabilities&&e.advancedQueryCapabilities.supportsPagination?this.queryExecute(p,b,!0,g,a):this._getFeatureIds(c,a).then(m.hitch(this,function(c){this.domNode&&(this.layer._objectIds=c,this.queryExecute(p,b,!0,g,a))}),m.hitch(this,function(a){console.error(a);
this.changeToolbarStatus()}))}}}),m.hitch(this,function(a){console.error(a);this.changeToolbarStatus()}))},_getFeatureCount:function(a,c){var d=new x,b=new H(this.configedInfo.layer.url),e=new I;e.returnGeometry=!1;e.where=this._getLayerFilterExpression();c&&(e.where+=" AND "+this.layer.objectIdField+" IN ("+c.join()+")");a&&(e.geometry=a);(this._currentDef=b.executeForCount(e,m.hitch(this,function(a){return a}))).then(m.hitch(this,function(a){d.resolve(a)}),m.hitch(this,function(a){a&&"Request canceled"!==
a.message&&(console.error(a),console.log("Could not get feature count."));this.loading.hide();d.reject(a)}));return d},_queryFeatureLayer:function(a,c,d,b,e){var f=new H(this.configedInfo.layer.url),p=new I;p.where=this._getLayerFilterExpression();e&&c&&(p.where+=" AND "+c+" IN ("+e.join()+")");var g=this._getOutFieldsFromLayerInfos(c);e=this._hasArcadeExpressionFields();if(0<g.length&&!e){var h=[];A.forEach(g,function(a){h.push(a.name)});p.outFields=h}else p.outFields=["*"];a&&(p.geometry=a,p.spatialRelationship=
I.SPATIAL_REL_INTERSECTS);p.outSpatialReference=m.clone(this.map.spatialReference);p.returnGeometry="esriGeometryPoint"===this.layer.geometryType;c&&(p.orderByFields=[c+" ASC"]);(this._currentDef=f.execute(p,m.hitch(this,function(a){return a}))).then(m.hitch(this,function(c){this.queryExecute(g,d,b,c,a)}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&console.error(a);this.changeToolbarStatus();this.loading.hide()}))},_getFeatureIds:function(a,c){var d=new x,b=new H(this.configedInfo.layer.url),
e=new I;e.returnGeometry=!1;e.returnIdsOnly=!0;e.where=this._getLayerFilterExpression();if(this.layer._orderByFields||a)e.orderByFields=this.layer._orderByFields||[a+" ASC"];c&&(e.geometry=c);(this._currentDef=b.executeForIds(e,m.hitch(this,function(a){return a}))).then(m.hitch(this,function(a){d.resolve(a)}),m.hitch(this,function(a){a&&"Request canceled"!==a.message&&(console.error(a),console.log("Could not get feature Ids"));d.resolve([])}));return d},queryExecute:function(a,c,d,b,e){var f=[],f=
null,p={};if(this.domNode){b.fields=this._processExecuteFields(this.layer.fields,a);d?f=N.generateCacheStore(this.layer,c,this._batchCount,this._getLayerFilterExpression(),e):(f=A.map(b.features,m.hitch(this,function(a){var c=m.clone(a.attributes);return m.mixin(c,{geometry:a.geometry})})),f=N.generateMemoryStore(f,this.layer.objectIdField));a=this.layer.typeIdField;var p=this.layer.types,g=m.getObject("advancedQueryCapabilities.supportsOrderBy",!1,this.layer),x=m.getObject("advancedQueryCapabilities.supportsPagination",
!1,this.layer),y=m.getObject("advancedQueryCapabilities.supportsStatistics",!1,this.layer),p=N.generateColumnsFromFields(this.grid&&this.grid.columns,this.layerInfo,b.fields,a,p,g&&x||!d,y,this.layer);this.layer.hasAttachments&&this.layer.objectIdField&&this.configedInfo.showAttachments&&(p.attachmentsColumn=this.formatAttachmentsColumn());d=20+100*b.fields.length<h.getMarginBox(this.domNode).w;this.createTable(p,f,c,d);this._currentExtent=e;c=this.layer.getSelectedFeatures();this.selectionRows&&
0<this.selectionRows.length?this._updateSelectRowsByIds(this.selectionRows):c&&0<c.length?this._updateSelectRowsByFeatures(c):this.grid.clearSelection();this.changeToolbarStatus();this.emit("data-loaded")}},formatAttachmentsColumn:function(){var a={label:this.nls.attachments,className:"attachments-column",hidden:!1,unhidable:!0,field:"at-show-attachments",sortable:!1,_cache:{sortable:!1,statistics:!1}};a.renderCell=m.hitch(this,function(a,c,d){var b=a[this.layer.objectIdField];this.layer.queryAttachmentInfos(b,
m.hitch(this,function(a){var c=A.map(a,m.hitch(this,function(a){var c=a.name&&/\.(png|jpg|jpeg|gif)$/gi.test(a.name)?"image-type":"file-type",d=U.findCredential(this.layer.url);return'\x3cli class\x3d"'+c+'"\x3e\x3ca class\x3d"jimu-ellipsis" target\x3d"_blank" href\x3d"'+(this.layer.url+"/"+b+"/attachments/"+a.id+(d?"?token\x3d"+d.token:""))+'"\x3e'+a.name+"\x3c/a\x3e\x3c/li\x3e"})),e="";0<a.length&&(e=" "+this.nls.files);e='\x3cdiv class\x3d"attachment-infos"\x3e\x3cdiv class\x3d"show-attachments-div"\x3e\x3cspan class\x3d"show-attachments"\x3e'+
a.length+e+'\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"attachment-popup"\x3e\x3cdiv class\x3d"attachment-popup-header"\x3e\x3cspan\x3e'+c.length+"\x26nbsp;"+this.nls.files+'\x3c/span\x3e\x3cspan class\x3d"close jimu-float-trailing"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul class\x3d"attachment-popup-content"\x3e'+c.join("")+"\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e";e=h.toDom(e);0<a.length&&(a=O(".show-attachments-div",e)[0],h.addClass(a,"has-attachments"));d.appendChild(e);this.own(C(d,"click",m.hitch(this,
function(a){a=a&&a.target;if(h.hasClass(a,"show-attachments-div")||h.hasClass(a,"show-attachments")||h.hasClass(a,"close")){a=this._visibleAttachmentPopup;var b=O(".attachment-popup",d)[0];b&&0<c.length&&h.toggleClass(b,"show");h.hasClass(b,"show")?this._visibleAttachmentPopup=b:this._visibleAttachmentPopup=null;a&&a!==b&&h.toggleClass(a,"show")}})))}),m.hitch(this,function(a){console.error(a)}))});return a},createTable:function(a,c,d,b){if(this.grid)this.grid.set("store",c),this.grid.set("columns",
a),this.grid.refresh();else{var e={};e.columns=a;e.store=c;e.keepScrollPosition=!0;e.pagingDelay=1E3;e.allowTextSelection=this.allowTextSelection;e.deselectOnRefresh=!1;this.layer.objectIdField||(e.minRowsPerPage=this.layer.maxRecordCount||1E3,e.maxRowsPerPage=this.layer.maxRecordCount||1E3,e.selectionMode="none");this.grid=new (k([l,q,u,v,w]))(e,h.create("div"));h.place(this.grid.domNode,this.domNode);this.grid.startup();this.tipNode&&h.destroy(this.tipNode);this.own(C(this.ownerDocument,"keydown",
m.hitch(this,function(a){this.allowTextSelection&&this.grid&&this.grid.allowTextSelection&&a.shiftKey&&this.grid._setAllowTextSelection(!1)})));this.own(C(this.ownerDocument,"keyup",m.hitch(this,function(){this.allowTextSelection&&this.grid&&!this.grid.allowTextSelection&&this.grid._setAllowTextSelection(!0)})));this.layer.objectIdField&&(this.own(C(this.grid,".dgrid-header .dgrid-cell:click",m.hitch(this,this._onHeaderClick))),this.own(C(this.grid,"dgrid-columnstatechange",m.hitch(this,this._onColumnStateChange))),
this.own(C(this.grid,".selection-handle-column:click",m.hitch(this,this._onSelectionHandleClick))),this.own(C(this.grid,".dgrid-row:dblclick",m.hitch(this,this._onDblclickRow))),this.own(C(this.grid,"dgrid-sort",m.hitch(this,function(a){this.emit("sort",a)}))),a=this.map.getLayer(this.layer.id),this.syncSelection&&a&&this.own(C(a,"click",m.hitch(this,this._onFeaturelayerClick))))}this.grid.get("sort")[0]||(this.configedInfo&&this.configedInfo.sortField?this.grid.set("sort",this.configedInfo.sortField,
this.configedInfo.isDescending):this.layer.objectIdField&&this.grid.set("sort",this.layer.objectIdField,!1));this.getParent()&&(a=O(".dgrid-scroller",this.grid.domNode)[0],e=O(".dgrid-header",this.grid.domNode)[0],c=h.getComputedStyle(a),e=h.getMarginBox(e),c=parseInt(c.marginTop,10),isFinite(c)&&e&&c<e.h&&h.setStyle(a,"marginTop",e.h+"px"));b?h.addClass(this.domNode,"auto-width"):h.removeClass(this.domNode,"auto-width");this.footer?h.empty(this.footer):this.footer=h.create("div",{"class":"jimu-widget-attributetable-feature-table-footer"},
this.domNode);d=h.create("div",{"class":"dgrid-status self-footer",innerHTML:d+"\x26nbsp;"+(this.layerInfo.isTable?this.nls.records:this.nls.features)+"\x26nbsp;"},this.footer);this.selectedRowsLabel=h.create("div",{"class":"dgrid-status self-footer",innerHTML:"0\x26nbsp;"+this.nls.selected+"\x26nbsp;",style:{display:this.layer.objectIdField?"":"none"}},d,"after");d=h.getStyle(this.domNode,"height");this.changeHeight(d);this._requestStatus="fulfilled";this.tableCreated=!0;h.place(this.loading.domNode,
this.grid.domNode);this.loading.hide()},getSelectedRowsData:function(){var a=new x,c=this._getTableSelectedIds()||[];if(!this.grid||!c.length)return a.resolve(null),a;this.grid.store instanceof G?(c=m.clone(this.grid.store.data),a.resolve(c)):this.grid.store.query(c,{_export_count:c.length}).then(m.hitch(this,function(c){c=c&&m.clone(this.grid.store._entityData||this.grid.store.data);a.resolve(c)}));return a},_appendXY:function(a){a&&"esriGeometryPoint"===this.layer.geometryType&&A.forEach(a,function(a){var c=
a.geometry;c&&"point"===c.type&&("x"in a?a._x=c.x:a.x=c.x,"y"in a?a._y=c.y:a.y=c.y);delete a.geometry})},getOutFields:function(a){var c=null,c=this._getOutFieldsFromLayerInfos(this.layer.objectIdField),c=this._processExecuteFields(this.layer.fields,c),c=m.clone(c);a&&(a="",a=-1!==c.indexOf("x")?"_x":"x",c.push({name:a,alias:a,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}),a=-1!==c.indexOf("y")?"_y":"y",c.push({name:a,alias:a,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"}));
return c},setSelectedNumber:function(){if(this.selectedRowsLabel&&this.grid){var a=this.getSelectedRows(),c=0;if(this.grid.store instanceof G){var d=A.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);A.forEach(a,function(a){-1<d.indexOf(a)&&c++})}else c=a.length;this.selectedRowsLabel.innerHTML="\x26nbsp;\x26nbsp;"+c+" "+this.nls.selected+"\x26nbsp;\x26nbsp;"}},_setSelection:function(a){this._selectionResults=a=a||[];this.selectionManager.setSelection(this.layer,a)},
_zoomToExtentByFeatures:function(a){return this.getExtent(a).then(m.hitch(this,function(a){if(a&&this.domNode){var c=null;if("point"===a.type){var d=this.map.getNumLevels(),b=this.map.getLevel(),c=this.map.getMaxZoom();0<d?(b===c?d=b:(d=b+4,d>c&&(d=c)),c=this.map.centerAndZoom(a,d)):c=this.map.centerAndZoom(a,1/Math.pow(2,4)*2)}else c=this.map.setExtent(a.expand(2));return c.then(function(){return a})}}))},_showMapInfoWindowByFeatures:function(a,c){if(c&&0!==c.length&&this.domNode){var d=this.map.infoWindow,
b=this.layerInfo.isPopupEnabled()&&this.layerInfo.getInfoTemplate();if(d&&d.setFeatures&&1===c.length&&b){A.forEach(c,m.hitch(this,function(a){a._layer=this.layerInfo.layerObject;a.setInfoTemplate(b)}));d.setFeatures(c);var e=null,e="point"===a.type?c[0].geometry:a.getCenter();d.show(e,{closetFirst:!0});this._dblClickResult=c[0];this.syncWithMapInfowindow(this._dblClickResult)}}},selectFeatures:function(a,c){if(c&&0<c.length){if("rowclick"===a||"selectall"===a)this._setSelection(c);else if("zoom"===
a||"row-dblclick"===a){var d=L.graphicsExtent(c),b=L.toFeatureSet(c),e=C(this.map,"zoom-end, pan-end",m.hitch(this,function(){e.remove();"row-dblclick"===a&&this.domNode&&this._showMapInfoWindowByFeatures(d,c)}));L.zoomToFeatureSet(this.map,b).then(null,function(a){a&&(console.error(a.message),e&&e.remove())})}this.setSelectedNumber()}else this._popupMessage(this.nls.dataNotAvailable)},syncWithMapInfowindow:function(a){var c=this.map.infoWindow,d=m.isArray(a)?a:[a];C.once(c,"hide",m.hitch(this,function(){b&&
b.remove&&(b.remove(),b=null)}));var b=V.after(c,"show",m.hitch(this,function(){var a=c.getSelectedFeature(),a=a&&d[0]===a,e=-1;c.features&&(e=c.features.indexOf(d[0]));!a&&-1<e?c.select(e):this.domNode&&!a&&b&&b.remove&&(b.remove(),b=null)}))},getGraphicsFromLocalFeatureLayer:function(a){for(var c=[],d,b,e=a.length,f=this.layer.graphics.length,p=this.layer.objectIdField,g=0;g<e;g++)for(var h=0;h<f;h++)if(d=this.layer.graphics[h].attributes[p]+"",b=a[g]+"",d===b){c.push(this.layer.graphics[h]);break}return c},
getExtent:function(a){var c=new x,d,b,e=a.length;if(1===e&&a[0].geometry&&"point"===a[0].geometry.type)d=a[0].geometry;else if(1!==e||a[0].geometry)for(var f=0;f<e;f++)a[f].geometry?"point"===a[f].geometry.type?(b||(b=new R(a[f].geometry.spatialReference)),b.addPoint(a[f].geometry),f===e-1&&(d=b.getExtent())):d=d?d.union(a[f].geometry.getExtent()):a[f].geometry.getExtent():console.error("unable to get geometry of the reocord: ",a[f]);else return c.reject(Error("AttributeTable.getExtent:: extent was not projected.")),
c;if(!d||!d.spatialReference)return c.reject(Error("AttributeTable.getExtent:: extent was not projected.")),c;a=this.map.spatialReference;d.spatialReference.equals(a)?c.resolve(d):(b=new Q,b.geometries=[d],b.outSR=a,K.defaults.geometryService.project(b,m.hitch(this,function(a){this.domNode&&(a&&a.length?c.resolve(a[0]):c.reject(Error("AttributeTable.getExtent:: extent was not projected.")))}),m.hitch(this,function(a){a||(a=Error("AttributeTable.getExtent:: extent was not projected."));c.reject(a)})));
return c},_onFeaturelayerClick:function(a,c){if(this.actived){var d=m.getObject("graphic",!1,a),b=m.getObject("graphic.attributes",!1,a);b&&d&&d._layer===this.layer&&((d=this.map.infoWindow.getSelectedFeature())&&d._layer===this.layer&&!c&&this.map.infoWindow.hide(),c=b[this.layer.objectIdField],this.showSelected&&this.toggleSelectedRecords(),this._getIndexOfIdInGrid(c).then(m.hitch(this,function(c){-1!==c&&(this.grid.scrollTo({x:0,y:this.grid.rowHeight*c}),this.map.infoWindow.features&&(c=this.map.infoWindow.features.indexOf(a.graphic),
this.map.infoWindow.select(c)),C.once(this.map.infoWindow,"selection-change",m.hitch(this,function(){var c=this.map.infoWindow.getSelectedFeature(),d=m.getObject("_layer",!1,c);c!==a.graphic&&d===this.layer&&this._onFeaturelayerClick({graphic:c},!0)})),this.syncWithMapInfowindow(a.graphic))})))}},_getIndexOfIdInGrid:function(a){var c=new x,d=-1,b=m.getObject("store.objectIds",!1,this.grid),d=null,d=this.grid.get("sort")[0];if(this._relatedQuery)return c.resolve(-1),c;if(this.grid.store instanceof
G)a=this.grid.store.get(a),b=this.grid.store.data,a?d&&d.attribute&&D.isDefined(d.descending)?(b=m.clone(b),d=function(a,c){return function(d,b){return d[a]===b[a]?0:d[a]<b[a]?c?1:-1:c?-1:1}}(d.attribute,d.descending),b.sort(d),b=A.map(b,function(a){return a[this.layer.objectIdField]},this),d=b.indexOf(a[this.layer.objectIdField])):d=b.indexOf(a):d=-1,c.resolve(d);else if(b&&0<b.length)d=b.indexOf(a),c.resolve(d);else{b=new I;b.returnGeometry=!1;b.where=this._getLayerFilterExpression()+" AND "+this.layer.objectIdField+
" \x3c "+a;if(d&&(d.attribute!==this.layer.objectIdField||d.descending))return c.resolve(-1),c;this.matchingMap&&!this._relatedQuery&&this._currentExtent&&(b.geometry=this._currentExtent);(this._currentDef=this.layer.queryCount(b)).then(m.hitch(this,function(a){c.resolve(a)}),m.hitch(this,function(a){c.reject(a)}))}return c},_zoomToSelected:function(){if(this.configedInfo&&this.tableCreated){var a=this.getSelectedRows();this._goToFeatures(a,"zoom")}},_goToFeatures:function(a,c){if(0!==a.length){var d=
this.getGraphicsFromLocalFeatureLayer(a);this.isSupportQueryToServer()&&a.length!==d.length?this._queryFeaturesByIds(a,c):this.selectFeatures(c,d)}},_onDblclickRow:function(a){this.layerInfo&&this.layerInfo.isShowInMap()&&(a=[this.grid.row(a).id],this._goToFeatures(a,"row-dblclick"))},_queryFeaturesByIds:function(a,c){var d=new I;d.objectIds=a;d.returnGeometry=!0;d.outSpatialReference=m.clone(this.map.spatialReference);d.outFields=["*"];a=this.layer;var b="esri.layers.CSVLayer"===a.declaredClass;
a.url&&!b?(new H(a.url)).execute(d,m.hitch(this,function(a){this.selectFeatures(c,a.features)}),m.hitch(this,this._errorSelectFeatures)):a.selectFeatures(d,M.SELECTION_NEW,m.hitch(this,this.selectFeatures,c),m.hitch(this,this._errorSelectFeatures))},_onHeaderClick:function(a){var c=this.grid.cell(a);this._showColumnMenu(c.column,c,a.target,{x:a.pageX,y:a.pageY})},_showColumnMenu:function(a,c,d,e){var f=m.getObject("_cache",!1,a);if(f&&(f.sortable||f.statistics)){var p=new g({});h.addClass(p.domNode,
"jimu-widget-attributetable-feature-menu");var x=this;if(f.sortable){var z=["iconSortAscending","iconSortDescending"];A.forEach([this.nls.sortAsc,this.nls.sortDes],function(c,d){c=new b({label:c,iconClass:z[d],baseClass:"menuItemClass",onClick:function(){0===d?x.grid.set("sort",a.field,!1):1===d&&x.grid.set("sort",a.field,!0)}});p.addChild(c)})}f.statistics&&(f=new b({label:this.nls.statistics,iconClass:"iconTableStatistics",baseClass:"menuItemClass",onClick:m.hitch(this,function(){var c={layer:this.layer,
filterExpression:this._getLayerFilterExpression(),fieldNames:[a.field]};this.matchingMap&&(c.geometry=this._currentExtent);if(this.showSelected){var d=this._getSelectedIds();c.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+d.join()+")"}else this.queryByStoreObjectIds&&0<this.queryByStoreObjectIds.length&&(c.filterExpression+=" AND "+this.layer.objectIdField+" IN ("+this.queryByStoreObjectIds.join()+")");this.fieldStatistics=new X;this.fieldStatistics.showContentAsPopup(c)})}),p.addChild(f));
f=p.getChildren();p.startup();p._openMyself({target:d,delegatedTarget:c,iframe:null,coords:e});this.own(C(p,"Close",m.hitch(this,function(){var a=this.get("columnMenu");a&&(a.destroyRecursive(),this.set("columnMenu",null))})));this.set("columnMenu",p);1>f.length&&C.emit(p,"Close")}},_onColumnStateChange:function(a){if(a&&a.grid&&a.grid.columns){var c=0,d;for(d in a.grid.columns)a.grid.columns[d].hidden||c++;20+100*c-1<h.getMarginBox(this.domNode).w?h.addClass(this.domNode,"auto-width"):h.removeClass(this.domNode,
"auto-width")}},_onSelectionHandleClick:function(){var a=this._getSelectedIds();this.selectionRows=a;this._closePopup();this.layerInfo.isTable||(0<a.length?this._goToFeatures(a,"rowclick"):this._setSelection([]));this.setSelectedNumber();this.emit("row-click",{table:this,selectedIds:a})},_onExtentChange:function(a){var c=m.getObject("delta.x",!1,a),d=m.getObject("delta.y",!1,a);a=this._clickMap&&!a.levelChange?isFinite(c)&&isFinite(d)&&(0<Math.abs(c)||0<Math.abs(d)):!0;this._clickMap=!1;a&&this.matchingMap&&
this.actived&&this.layerInfo&&!this.layerInfo.isTable&&this.startQuery(this.queryByStoreObjectIds)},_getLayerFilterExpression:function(){var a=this.layerInfo.getFilter();return a?a:"1\x3d1"},_getOutFieldsFromLayerInfos:function(a){var c=this.configedInfo.layer.fields,d=this.layerInfo.getPopupInfo(),b=d&&d.fieldInfos,e=[];c&&A.forEach(c,m.hitch(this,function(c){if(!D.isDefined(c.show)&&(c.show=!0,b))for(var d=0,f=b.length;d<f;d++){var p=b[d];p.fieldName===c.name&&(c.show=p.visible)}c.name!==a||"esriFieldTypeOID"!==
c.type&&"esriFieldTypeInteger"!==c.type&&c.type||(c._pk=!0);(c.show||c._pk)&&e.push(c)}));return e},_processExecuteFields:function(a,c){if(a&&0<a.length){var d=[];if(!c.length)return a;for(var b=0,e=c.length;b<e;b++)for(var f=0;f<a.length;f++)c[b].name!==a[f].name||c[b].type!==a[f].type&&c[b].type||(a[f]=m.mixin(a[f],c[b]),d.push(a[f]));return d}return c},_getSelectedIds:function(){var a=[],c=this.grid.selection,d;for(d in c)c[d]&&(isFinite(d)?a.push(parseInt(d,10)):a.push(d));return a},_getTableSelectedIds:function(){var a=
[],c=this.getSelectedRows();if(this.grid)if(this.grid.store instanceof G){var d=A.map(this.grid.store.data,function(a){return a[this.layer.objectIdField]},this);A.forEach(c,function(c){-1<d.indexOf(c)&&a.push(parseInt(c,10))})}else a=c;return a},isSelectionMode:function(){var a=this.getSelectedRows();return this.tableCreated&&a&&0<a.length&&this.layer&&this.layer.objectIdField?!0:!1},_errorSelectFeatures:function(a){console.error(a)},_popupMessage:function(a){var c=new t({message:a,buttons:[{label:this.nls.ok,
onClick:m.hitch(this,function(){c.close()})}]});this.loading.hide()},_hasArcadeExpressionFields:function(){return this.layerInfo.getPopupInfo()&&this.layerInfo.getPopupInfo().expressionInfos&&A.some(this.configedInfo.layer.fields,function(a){return N.arcade.isArcadeExpressionField(a)})}})})},"widgets/AttributeTable/dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect dgrid/List dojo/has!touch?dgrid/util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(k,h,r,t,n,l,q,u,v){function w(a,d){d=a.unselectable=d?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=d)}function g(a,d){var c=a.bodyNode,b=d?"text":21>n("ff")?"-moz-none":"none";f&&"msUserSelect"!==f?c.style[f]=b:n("dom-selectstart")?d||a._selectstartHandle?d&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=t(c,"selectstart",function(a){var c=a.target&&
a.target.tagName;"INPUT"!==c&&"TEXTAREA"!==c&&a.preventDefault()}):(w(c,!d),d||a._unselectableHandle)?d&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=l.after(a,"renderRow",function(a){w(a,!0);return a})}n.add("dom-comparedocumentposition",function(a,d,b){return!!b.compareDocumentPosition});n.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});n.add("css-user-select",function(a,d,b){a=b.style;
d=["Khtml","O","ms","Moz","Webkit"];b=d.length;var c="userSelect";do if("undefined"!==typeof a[c])return c;while(b--&&(c=d[b]+"UserSelect"));return!1});n.add("dom-selectstart","undefined"!==typeof document.onselectstart);var b=n("mac")?"metaKey":"ctrlKey",f=n("css-user-select"),e=(q=n("pointer"))&&"MS"===q.slice(0,2),a=q?q+(e?"Down":"down"):"mousedown",d=q?q+(e?"Up":"up"):"mouseup";"WebkitUserSelect"===f&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(f=!1);return h("dgrid.Selection",
null,{selectionDelegate:".dgrid-cell.dgrid-cell-padding.dgrid-column-selectionHandle.field-selectionHandle.selection-handle-column",selectionEvents:a+","+d+",dgrid-cellfocusin",selectionTouchEvents:n("touch")?u.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=
this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){k.deprecated("setSelectionMode(...)",
'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?g(this,a):g(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(c,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==c.type||"mousedown"!==c.parentType)&&(c.type!==d||b==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=c;if(!c.keyCode||!c.ctrlKey||32==c.keyCode)if(!c.shiftKey&&
c.type===a&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](c,b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,d){a=a.keyCode?a.ctrlKey:a[b];this._lastSelected===d?this.select(d,null,!a||!this.isSelected(d)):(this.clearSelection(),this.select(d),this._lastSelected=d)},_multipleSelectionHandler:function(a,d){var c=this._lastSelected,e=a.keyCode?a.ctrlKey:a[b],f;a.shiftKey||(f=e?null:!0,c=null);this.select(d,c,f);c||(this._lastSelected=d)},_extendedSelectionHandler:function(a,
d){(2===a.button?this.isSelected(d):a.keyCode?a.ctrlKey:a[b])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,d)},_toggleSelectionHandler:function(a,d){this.select(d,null,null)},_initSelectionEvents:function(){var a=this,e=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};n("touch")&&!n("pointer")&&this.selectionTouchEvents?(t(e,u.selector(f,this.selectionTouchEvents),function(c){a._handleSelect(c,this);a._ignoreMouseSelect=this}),t(e,t.selector(f,
this.selectionEvents),function(c){a._ignoreMouseSelect!==this?a._handleSelect(c,this):c.type===d&&(a._ignoreMouseSelect=null)})):t(e,t.selector(f,this.selectionEvents),function(c){a._handleSelect(c,this)});this.addKeyHandler&&this.addKeyHandler(32,function(c){a._handleSelect(c,c.target)});if(this.allowSelectAll)this.on("keydown",function(c){c[b]&&65==c.keyCode&&!/\bdgrid-input\b/.test(c.target.className)&&(c.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setStore&&l.after(this,
"_setStore",function(){a._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,c,b){a=c||a&&a[d.idProperty||"id"];if(null!=a&&(c=(a=d.row(a))&&d.selection[a.id]))d[b](a,null,c)}var d=this,b=this.store,e,f;this._removeDeselectSignals&&this._removeDeselectSignals();b&&b.notify?(e=l.before(b,"notify",function(c,d){c||a(c,d,"deselect")}),f=l.after(b,"notify",function(c,d){a(c,d,"select")},!0),this._removeDeselectSignals=function(){e.remove();f.remove()}):
(e=l.before(this,"removeRow",function(a,c){c||(a=this.row(a))&&a.id in this.selection&&this.deselect(a)}),this._removeDeselectSignals=function(){e.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var c=this._selectionEventQueues[a],d=this._selectionTriggerEvent,b;b={bubbles:!0,grid:this};d&&(b.parentType=d.type);b[this._selectionTargetType]=c;this._selectionEventQueues[a]=[];t.emit(this.contentNode,"dgrid-"+a,b)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,
d;for(d in a)a[d].length&&this._fireSelectionEvent(d)},_select:function(a,d,b){var c,e,f;"undefined"===typeof b&&(b=!0);a.element||(a=this.row(a));if(!1===b||this.allowSelect(a))if(c=this.selection,e=!!c[a.id],null===b&&(b=!e),f=a.element,b||this.allSelected?c[a.id]=b:delete this.selection[a.id],f&&(b?v(f,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):v(f,"!dgrid-selected!ui-state-active")),b!==e&&f&&this._selectionEventQueues[(b?"":"de")+"select"].push(a),d)if(d.element||(d=this.row(d)),
d){if(d=d.element)for(c=this._determineSelectionDirection(f,d),c||(d=document.getElementById(d.id),c=this._determineSelectionDirection(f,d));a.element!=d&&(a=this[c](a));)this._select(a,null,b)}else this._lastSelected=f,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:n("dom-comparedocumentposition")?
function(a,d){a=d.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,d){return 1>d.sourceIndex?!1:d.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,d,b){this._select(a,d,b);this._fireSelectionEvents()},deselect:function(a,d){this.select(a,d,!1)},clearSelection:function(a,d){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);d||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var d=
this.row(this._rowIdToObject[a]);this._select(d.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,d=this.inherited(arguments);r.when(d,function(c){var d=a.selection,
b,e,f;for(b=0;b<c.length;b++)e=a.row(c[b]),(f=e.id in d?d[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});return d}})})},"dgrid/extensions/ColumnHider":function(){define("dojo/_base/declare dojo/has dojo/on ../util/misc put-selector/put dojo/i18n!./nls/columnHider xstyle/css!../css/extensions/ColumnHider.css".split(" "),function(k,h,r,t,n,l){var q,u,v=h("ie"),w=v&&h("quirks"),g=8>v||w?"htmlFor":"for";return k("dgrid.extensions.ColumnHider",null,{hiderMenuNode:null,hiderToggleNode:null,
i18nColumnHider:l,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var b=this.subRows,f=!0,e,a,d,c;delete this._columnHiderFirstCheckbox;d=0;for(e=b.length;d<e;d++)for(c=0,a=b[d].length;c<a;c++)this._renderHiderMenuEntry(b[d][c]),f&&(f=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[b[d][c].id])},_renderHiderMenuEntry:function(b){var f=b.id,e=t.escapeCssIdentifier(f,"-"),a,d;b.hidden&&(b.hidden=!1,this._hideColumn(f),b.hidden=
!0);b.unhidable||(a=n("div.dgrid-hider-menu-row"),d=this.domNode.id+"-hider-menu-check-"+e,f=this._columnHiderCheckboxes[f]=n(a,"input.dgrid-hider-menu-check.hider-menu-check-"+e+"[type\x3dcheckbox]"),f.id=d,n(a,"label.dgrid-hider-menu-label.hider-menu-label-"+e+"["+g+"\x3d"+d+"]",b.label||b.field||""),n(this.hiderMenuNode,a),b.hidden||(f.checked=!0))},renderHeader:function(){function b(a){a.stopPropagation()}var f=this,e=this.hiderMenuNode,a=this.hiderToggleNode,d;this.inherited(arguments);if(e){for(d in this._columnHiderRules)this._columnHiderRules[d].remove();
e.innerHTML=""}else a=this.hiderToggleNode=n(this.domNode,"button.ui-icon.dgrid-hider-toggle[type\x3dbutton][aria-label\x3d"+this.i18nColumnHider.popupTriggerLabel+"]"),this._listeners.push(r(a,"click",function(a){f._toggleColumnHiderMenu(a)})),e=this.hiderMenuNode=n("div.dgrid-hider-menu[role\x3ddialog][aria-label\x3d"+this.i18nColumnHider.popupLabel+"]"),e.id=this.id+"-hider-menu",this._listeners.push(r(e,"keyup",function(c){27===(c.charCode||c.keyCode)&&(f._toggleColumnHiderMenu(c),a.focus())})),
e.style.display="none",n(this.domNode,e),this._listeners.push(r(e,".dgrid-hider-menu-check:"+(9>v||w?"click":"change"),function(a){f._updateColumnHiddenState(a.target.id.substr(f.id.length+18),!a.target.checked)})),this._listeners.push(r(e,"mousedown",b),r(a,"mousedown",b)),u||(u=r.pausable(document,"mousedown",function(a){q&&q._toggleColumnHiderMenu(a)}),u.pause());this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);
for(var b in this._columnHiderRules)this._columnHiderRules[b].remove()},left:function(b,f){return this.right(b,-f)},right:function(b,f){b.element||(b=this.cell(b));for(var e=this.inherited(arguments),a=b;e.column.hidden;){e=this.inherited(arguments,[e,0<f?1:-1]);if(a.element===e.element)return b;a=e}return e},isColumnHidden:function(b){return!!this._columnHiderRules[b]},_toggleColumnHiderMenu:function(){var b=this._hiderMenuOpened,f=this.hiderMenuNode,e=this.domNode,a;f.style.display=b?"none":"";
b?f.style.height="":(f.offsetHeight>e.offsetHeight-12&&(f.style.height=e.offsetHeight-12+"px"),(a=this._columnHiderFirstCheckbox)&&a.focus());u[b?"pause":"resume"]();q=b?null:this;this._hiderMenuOpened=!b},_hideColumn:function(b){var f=this,e="#"+t.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",a;this._columnHiderRules[b]||(this._columnHiderRules[b]=t.addCssRule(e+t.escapeCssIdentifier(b,"-"),"display: none;"),8!==h("ie")&&10!==h("ie")||h("quirks")||(a=t.addCssRule(".dgrid-row-table","display: inline-table;"),
window.setTimeout(function(){a.remove();f.resize()},0)))},_showColumn:function(b){this._columnHiderRules[b]&&(this._columnHiderRules[b].remove(),delete this._columnHiderRules[b])},_updateColumnHiddenState:function(b,f){this[f?"_hideColumn":"_showColumn"](b);this.columns[b].hidden=f;r.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[b],hidden:f,bubbles:!0});this.resize()},toggleColumnHiddenState:function(b,f){"undefined"===typeof f&&(f=!this._columnHiderRules[b]);this._updateColumnHiddenState(b,
f);this._columnHiderCheckboxes[b].checked=!f}})})},"dgrid/extensions/ColumnResizer":function(){define("dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(k,h,r,t,n,l,q,u,v){function w(a){for(var d=a.length,c=d,b=a[0].length,e=Array(d);d--;)e[d]=Array(b);for(var f={},d=0;d<c;d++)for(var g=e[d],h=a[d],k=0,l=0;k<b;k++){var p=h[l],B;if("undefined"==typeof g[k]){g[k]=
p.id;if(p.rowSpan&&1<p.rowSpan){B=e;for(var E=p.rowSpan,q=d,n=k,u=p.id,r=1;r<E;r++)B[q+r][n]=u}if(0<d&&p.colSpan&&1<p.colSpan)for(B=1;B<p.colSpan;B++)if(g[++k]=p.id,p.rowSpan&&1<p.rowSpan)for(var E=e,q=p.rowSpan,n=d,u=k,r=p.id,v=1;v<q;v++)E[n+v][u]=r;f[p.id]=a[0][k].id;l++}}return f}function g(a,d,c,b,e){if(!(0>=c)){var f=a.columns[d],g;if(f&&(g={grid:a,columnId:d,width:c,bubbles:!0,cancelable:!0},b&&(g.parentType=b),!a._resizedColumns||h.emit(a.headerNode,"dgrid-columnresize",g)))return"auto"===
c?delete f.width:(f.width=c,c+="px"),(b=a._columnSizes[d])?b.set("width",c):b=u.addCssRule("#"+u.escapeCssIdentifier(a.domNode.id)+" .dgrid-column-"+u.escapeCssIdentifier(d,"-"),"width: "+c+";"),a._columnSizes[d]=b,!1!==e&&a.resize(),!0}}var b,f=0,e={create:function(){b=v("div.dgrid-column-resizer")},destroy:function(){v(b,"!");b=null},show:function(a){a=l.position(a.domNode,!0);b.style.top=a.y+"px";b.style.height=a.h+"px";v(document.body,b)},move:function(a){b.style.left=a+"px"},hide:function(){b.parentNode.removeChild(b)}};
return k("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);f++||e.create()},destroy:function(){this.inherited(arguments);for(var a in this._columnSizes)this._columnSizes[a].remove();--f||e.destroy()},resizeColumnWidth:function(a,d){return g(this,a,d)},configStructure:function(){var a=this._oldColumnSizes=t.mixin({},this._columnSizes),d;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);
for(d in a)d in this._columnSizes||a[d].remove();delete this._oldColumnSizes},_configColumn:function(a){this.inherited(arguments);var d=a.id,c;"width"in a&&((c=this._oldColumnSizes[d])?c.set("width",a.width+"px"):c=u.addCssRule("#"+u.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+u.escapeCssIdentifier(d,"-"),"width: "+a.width+"px;"),this._columnSizes[d]=c)},renderHeader:function(){this.inherited(arguments);var a=this,d;if(this.columnSets&&this.columnSets.length)for(var c=this.columnSets.length;c--;)d=
t.mixin(d||{},w(this.columnSets[c]));else this.subRows&&1<this.subRows.length&&(d=w(this.subRows));for(var c=r(".dgrid-cell",a.headerNode),b=c.length;b--;){var e=c[b],f=e.columnId,g=a.columns[f],k=e.childNodes;if(g&&!1!==g.resizable){g=v("div.dgrid-resize-header-container");for(e.contents=g;0<k.length;)v(g,k[0]);v(e,g,"div.dgrid-resize-handle.resizeNode-"+u.escapeCssIdentifier(f,"-")).columnId=d&&d[f]||f}}a.mouseMoveListen||(h(a.headerNode,".dgrid-resize-handle:mousedown"+(q("touch")?",.dgrid-resize-handle:touchstart":
""),function(c){a._resizeMouseDown(c,this);a.mouseMoveListen.resume();a.mouseUpListen.resume()}),a._listeners.push(a.mouseMoveListen=h.pausable(document,"mousemove"+(q("touch")?",touchmove":""),u.throttleDelayed(function(c){a._updateResizerPosition(c)}))),a._listeners.push(a.mouseUpListen=h.pausable(document,"mouseup"+(q("touch")?",touchend":""),function(c){a._resizeMouseUp(c);a.mouseMoveListen.pause();a.mouseUpListen.pause()})),a.mouseMoveListen.pause(),a.mouseUpListen.pause())},_resizeMouseDown:function(a,
d){a.preventDefault();n.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(a);this._targetCell=r(".dgrid-column-"+u.escapeCssIdentifier(d.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(a);e.show(this)},_resizeMouseUp:function(a){var d=this._columnSizes,c,b,f;this.adjustLastColumn&&(f=this.headerNode.clientWidth-1);this._resizedColumns||(c=r(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?c=c.filter(function(a){return"0"==a.columnId.split("-")[0]&&
!(a.columnId in d)}):this.subRows&&1<this.subRows.length&&(c=c.filter(function(a){return"0"==a.columnId.charAt(0)&&!(a.columnId in d)})),b=c.map(function(a){return a.offsetWidth}),c.forEach(function(a,c){g(this,a.columnId,b[c],null,!1)},this),this._resizedColumns=!0);n.setSelectable(this.domNode,!0);c=this._targetCell;var h=this._getResizeMouseLocation(a)-this._startX,k=c.offsetWidth+h,l=this._getResizedColumnWidths(),q=l.totalWidth,l=l.lastColId,v=r(".dgrid-column-"+u.escapeCssIdentifier(l,"-"),
this.headerNode)[0].offsetWidth;k<this.minWidth&&(k=this.minWidth);g(this,c.columnId,k,a.type)&&c.columnId!=l&&this.adjustLastColumn&&(q+h<f?g(this,l,"auto",a.type):v-h<=this.minWidth&&g(this,l,this.minWidth,a.type));e.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(a){if(this._targetCell){a=this._getResizeMouseLocation(a);var d=this._targetCell.offsetWidth,c=a;d+(a-this._startX)<this.minWidth&&(c=this._startX-(d-this.minWidth));e.move(c)}},_getResizeMouseLocation:function(a){var d=
0;a.pageX?d=a.pageX:a.clientX&&(d=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return d},_getResizedColumnWidths:function(){var a=0,d=r((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),c=d.length;if(!c)return{};for(var b=d[c-1].columnId;c--;)a+=d[c].offsetWidth;return{totalWidth:a,lastColId:b}}})})},"dgrid/extensions/ColumnReorder":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/dnd/Source put-selector/put xstyle/css!../css/extensions/ColumnReorder.css".split(" "),
function(k,h,r,t,n,l,q){function u(b,f){var e=f[2];b=b[e?"columnSets":"subRows"][f[1]];return e?b[f[2]]:b}function v(b,f,e){f[2]?b.columnSets[f[1]][f[2]]=e:b.subRows[f[1]]=e}function w(b,f){return f.slice(("dgrid-"+b+"-").length)}var g=/(\d+)(?:-(\d+))?$/;k=h(l,{copyState:function(){return!1},checkAcceptance:function(b,f){return b==this},_legalMouseDown:function(b){return-1<b.target.className.indexOf("dgrid-resize-handle")?!1:this.inherited(arguments)},onDropInternal:function(b){var f=this.grid,e=
g.exec(w(f.id,b[0].getAttribute("dndType"))),a=e[2]?"columnSets":"subRows",d=u(f,e),c=f.columns;this.inherited(arguments);e&&setTimeout(function(){var g=r.map(b[0].parentNode.childNodes,function(a){return c[a.columnId]});v(f,e,g);g={grid:f,subRow:g,column:c[b[0].columnId],bubbles:!0,cancelable:!0,parentType:"dnd"};g[a]=f[a];t.emit(f.domNode,"dgrid-columnreorder",g)?f.set(a,f[a]):(v(f,e,d),f.renderHeader(),this._sort&&this._sort.length&&this.updateSortArrow(this._sort))},0)}});h=h("dgrid.extensions.ColumnReorder",
null,{columnDndConstructor:k,_initSubRowDnd:function(b,f){var e,a,d,c;a=0;for(d=b.length;a<d;a++)c=b[a],!1!==c.reorderable&&(c=c.headerNode,"TH"!=c.tagName&&(c=c.parentNode),q(c,".dojoDndItem[dndType\x3d"+f+"]"),e||(e=c.parentNode));e&&this._columnDndSources.push(new this.columnDndConstructor(e,{horizontal:!0,grid:this}))},renderHeader:function(){var b="dgrid-"+this.id+"-",f,e;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets)for(e=0,f=this.columnSets.length;e<f;e++)r.forEach(this.columnSets[e],
function(a,d){this._initSubRowDnd(a,b+e+"-"+d)},this);else r.forEach(this.subRows,function(a,d){this._initSubRowDnd(a,b+d)},this)},_destroyColumns:function(){this._columnDndSources&&r.forEach(this._columnDndSources,function(b){b.destroy()});this.inherited(arguments)}});h.ColumnDndSource=k;return h})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(k,h,r,t,n,l,q,u){r("dijit-legacy-requires")&&
n(0,function(){k(["dijit/ToolbarSeparator"])});return h("dijit.Toolbar",[l,u,q],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(k,h,r,t,n,l,q){k=k(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var h=r.map(this.geometries1,function(b){return b.toJson()}),k=r.map(this.geometries2,function(b){return b.toJson()}),l={},g=this.geometries1;g&&0<g.length&&(l.geometries1=t.toJson({geometryType:q.getJsonType(g[0]),geometries:h}),h=this.geometries1[0].spatialReference,l.sr=h.wkid?h.wkid:t.toJson(h.toJson()));(h=this.geometries2)&&0<h.length&&
(l.geometries2=t.toJson({geometryType:q.getJsonType(h[0]),geometries:k}));this.relation&&(l.relation=this.relation);this.relationParam&&(l.relationParam=this.relationParam);return l}});h.mixin(k,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",
SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});n("extend-esri")&&h.setObject("tasks.RelationParameters",k,l);return k})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query esri/graphic jimu/ArcadeUtils".split(" "),
function(k,h,r,t,n,l,q,u,v,w,g,b){function f(b){var a=h.clone(b.attributes);(b=b.geometry)&&"point"===b.type&&("x"in a?a._x=b.x:a.x=b.x,"y"in a?a._y=b.y:a.y=b.y);return a}k.exportCSV=function(b,a,d){return k._createCSVStr(a,d).then(function(a){return k._download(b+".csv",a)})};k.exportCSVFromFeatureLayer=function(b,a,d){d=d||{};return k._getExportData(a,{datas:d.datas,objectIds:d.objectIds,fromClient:d.fromClient,withGeometry:d.withGeometry,outFields:d.outFields,filterExpression:d.filterExpression,
outSpatialReference:d.outSpatialReference,arcadeExpressions:d.arcadeExpressions}).then(function(c){return k._formattedData(a,c,{formatNumber:d.formatNumber,formatDate:d.formatDate,formatCodedValue:d.formatCodedValue,richText:{clearFormat:d.richTextFieldsToClear&&!!d.richTextFieldsToClear.length,fieldsToClear:d.richTextFieldsToClear||[]},popupInfo:d.popupInfo}).then(function(a){return k.exportCSV(b,a.datas,a.columns)})})};k.exportCSVByAttributes=function(b,a,d,c){c=h.mixin({},c);c.datas=d;return k.exportCSVFromFeatureLayer(b,
a,c)};k.exportCSVByGraphics=function(b,a,d,c){d=r.map(d,function(a){return a.attributes});return k.exportCSVByAttributes(b,a,d,c)};k._createCSVStr=function(b,a){var d=new l,c="",e=0,f=0,g="",h="";try{a=r.map(a,function(a){return"string"===typeof a?{name:a}:a});r.forEach(a,function(a){a=a.alias||a.name;-1<a.toString().indexOf(",")&&(a='"'+a+'"');c=c+g+a;g=","});for(var c=c+"\r\n",e=b.length,f=a.length,k=0;k<e;k++){for(var g="",q=0;q<f;q++)(h=b[k][a[q].name])||"number"===typeof h||(h=""),h&&/[",\r\n]/g.test(h)&&
(h='"'+h.replace(/(")/g,'""')+'"'),c=c+g+h,g=",";c+="\r\n"}d.resolve(c)}catch(D){console.error(D),d.resolve("")}return d};k._isIE11=function(){return 11===q.has("ie")};k._isEdge=function(){return q.has("edge")};k._getDownloadUrl=function(b){return window.Blob&&window.URL&&window.URL.createObjectURL?(b=new Blob(["\ufeff"+b],{type:"text/csv"}),URL.createObjectURL(b)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(b)};k._download=function(b,a){var d=new l;try{if(n("ie")&&10>n("ie")){var c=
window.top.open("about:blank","_blank");c.document.write("sep\x3d,\r\n"+a);c.document.close();c.document.execCommand("SaveAs",!0,b);c.close()}else if(10===n("ie")||k._isIE11()||k._isEdge()){var e=new Blob(["\ufeff"+a],{type:"text/csv"});navigator.msSaveBlob(e,b)}else{var f=t.create("a",{href:k._getDownloadUrl(a),target:"_blank",download:b},document.body);if(n("safari")){var g=document.createEvent("MouseEvents");g.initEvent("click",!0,!0);f.dispatchEvent(g)}else f.click();t.destroy(f)}d.resolve()}catch(J){d.reject(J)}return d};
k._getExportData=function(b,a){var d=new l,c=null,e=[],g=a.datas,q=a.withGeometry,n=!!a.arcadeExpressions,c=a.outFields;c&&c.length||(c=b.fields);c=h.clone(c);if(q&&!(g&&0<g.length)){n?(e=r.filter(b.fields,function(a){return-1===a.name.indexOf("expression/")}),e=h.clone(e)):e=h.clone(c);var v="",v=-1!==c.indexOf("x")?"_x":"x";c.push({name:v,alias:v,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});v=-1!==c.indexOf("y")?"_y":"y";c.push({name:v,alias:v,format:{digitSeparator:!1,
places:6},show:!0,type:"esriFieldTypeDouble"})}g&&0<g.length?(n&&(g=k._getAttrsWithExpressionsBatch(g,a.arcadeExpressions)),d.resolve({data:g||[],outFields:c})):a.fromClient?(g=r.map(b.graphics,function(c){c=q?f(c):h.clone(c);return c=n?k._getAttrsWithExpressions(c,a.arcadeExpressions):c}),d.resolve({data:g||[],outFields:c})):k._getExportDataFromServer(b,e,a).then(function(b){n&&(b=k._getAttrsWithExpressionsBatch(b,a.arcadeExpressions));d.resolve({data:b||[],outFields:c})});return d};k._getExportDataFromServer=
function(b,a,d){var c=new l;if("esri.layers.FeatureLayer"!==b.declaredClass)return c.resolve([]),c;var e=new v(b.url),g=new w;g.where=d.filterExpression||b.getDefinitionExpression&&b.getDefinitionExpression()||"1\x3d1";0<a.length?(b=r.map(a,function(a){return a.name}),g.outFields=b):g.outFields=["*"];g.objectIds=d.objectIds;g.returnGeometry=d.withGeometry;g.outSR=d.spatialReference;e.execute(g,function(a){a=r.map(a.features,function(a){return f(a)});c.resolve(a)},function(a){console.error(a);c.resolve([])});
return c};k._formattedData=function(b,a,d){var c=new l,e=[],f=a.data;a=a.outFields;for(var g=0,h=f.length;g<h;g++){for(var q={},n=0;n<a.length;n++){var v=a[n];q[v.name]=k._getExportValue(f[g][v.name],v,b.objectIdField,b.typeIdField,f[g][b.typeIdField],b.types,d)}e.push(q)}b=r.map(a,function(a){return{alias:a.alias,name:a.name}});c.resolve({datas:e,columns:b});return c};k._getExportValue=function(b,a,d,c,f,g,h){function e(a){if(l&&u.isDefined(l.fieldInfos))for(var c=0,d=l.fieldInfos.length;c<d;c++){var b=
l.fieldInfos[c];if(b.fieldName===a)return b.format}return null}function k(a){for(var c=0,d=n.length;c<d;c++)if(n[c].fieldName===a)return!0;return!1}var l=h.popupInfo,n=h.richText.fieldsToClear,p=!!a.domain&&h.formatCodedValue,B="esriFieldTypeDate"===a.type&&h.formatDate,E=d&&a.name===d;c=c&&a.name===c;k="esriFieldTypeString"===a.type&&h.richText.clearFormat&&k(a.name);return B?q.fieldFormatter.getFormattedDate(b,e(a.name)):c?q.fieldFormatter.getTypeName(b,g):p?q.fieldFormatter.getCodedValue(a.domain,
b):k?b?(a=document.createElement("span"),a.innerHTML=b,a.textContent||a.innerText||""):b:p||B||E||c||k?b:(h=null,d&&g&&0<g.length&&(d=(d=r.filter(g,function(a){return a.id===f}))&&d[0])&&d.domains&&d.domains[a.name]&&d.domains[a.name].codedValues&&(h=q.fieldFormatter.getCodedValue(d.domains[a.name],b)),null!==h?h:b)};k._getAttrsWithExpressions=function(e,a){var d=h.getObject("expressionInfos",!1,a);a=h.getObject("layerDefinition",!1,a);var c=new g(null,null,e);return b.customExpr.getAttributesFromCustomArcadeExpr(d,
c,a)||e};k._getAttrsWithExpressionsBatch=function(b,a){var d=[];return d=r.map(b,function(c){return k._getAttrsWithExpressions(c,a)})}})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),function(k,h,r,t,n,l,q,u,v,w){var g={readExprInfo:{}};g.readExprInfo.getArcadeProfilesByType=function(b,f,e){b={map:b,layer:f};return"render"===
e?g.readExprInfo._getArcadeRender(b):"label"===e?g.readExprInfo._getArcadeLabel(b):"infoTemplate"===e?g.readExprInfo._getArcadeInfoTemplate(b):g.readExprInfo._getAllArcade(b)};g.readExprInfo._getArcadeRender=function(b){return g.readExprInfo._lookupArcadeRender({layers:g.readExprInfo._checkPassInLayer(b)})};g.readExprInfo._getArcadeInfoTemplate=function(b){return g.readExprInfo._lookupArcadeInfoTemplate({layers:g.readExprInfo._checkPassInLayer(b)})};g.readExprInfo._getArcadeLabel=function(b){return g.readExprInfo._lookupArcadeLabel({layers:g.readExprInfo._checkPassInLayer(b)})};
g.readExprInfo._getAllArcade=function(b){var f=g.readExprInfo._getArcadeRender(b),e=g.readExprInfo._getArcadeInfoTemplate(b);b=g.readExprInfo._getArcadeLabel(b);return{render:f,infoTemplate:e,label:b}};g.readExprInfo._checkPassInLayer=function(b){var f=[];return f="undefined"!==typeof b?"undefined"!==typeof b.layer?null!==b.layer&&""!==b.layer?g.readExprInfo._getAllMapLayers(b):g.readExprInfo._getAllMapLayers():g.readExprInfo._getAllMapLayers():g.readExprInfo._getAllMapLayers()};g.readExprInfo._getAllMapLayers=
function(b){var f="",e=[],a=w.getInstance();b&&b.layer&&(f=b.layer.id);""!==f?(b=a.getNodeById(f))&&e.push(b._layerInfo.layerObject):a.traversal(function(a){"undefined"!==typeof a._layerInfo.layerObject.type?-1===a._layerInfo.layerObject.type.indexOf("tile")&&e.push(a._layerInfo.layerObject):e.push(a._layerInfo.layerObject)});return e};g.readExprInfo._lookupArcadeRender=function(b){var f=[];0<b.layers.length&&k.forEach(b.layers,h.hitch(this,function(b){var a={};if("undefined"!==typeof b.renderer){var d=
b.renderer;"undefined"!==typeof d.valueExpression&&(a.layer=b.id,a.valueExpression=d.valueExpression,a.valueExpressionTitle=d.valueExpressionTitle,"undefined"!==typeof d.values&&(a.values=d.values),"undefined"!==typeof d.visualVariables&&(a.visualVariables=d.visualVariables));1<Object.keys(a).length&&a.constructor===Object?f.push(a):f.push({layer:b.id,valueExpression:null,valueExpressionTitle:null,values:null,visualVariables:null})}}));return f};g.readExprInfo._lookupArcadeInfoTemplate=function(b){var f=
[];0<b.layers.length&&k.forEach(b.layers,h.hitch(this,function(b){var a={};if("undefined"!==typeof b.infoTemplate)"undefined"!==typeof b.infoTemplate.info.expressionInfos&&0<b.infoTemplate.info.expressionInfos.length&&(a.layer=b.id,a.expressionInfos=b.infoTemplate.info.expressionInfos);else if("undefined"!==typeof b.infoTemplates)for(var d in b.infoTemplates)if(b.infoTemplates.hasOwnProperty(d)&&"undefined"!==typeof b.infoTemplates[d].infoTemplate.info.expressionInfos){var c=b.infoTemplates[d].infoTemplate;
0<c.info.expressionInfos.length&&(a.layer=b.id,a.expressionInfos=c.info.expressionInfos)}1<Object.keys(a).length&&a.constructor===Object?f.push(a):f.push({layer:b.id,expressionInfos:null})}));return f};g.readExprInfo._lookupArcadeLabel=function(b){var f=[];0<b.layers.length&&k.forEach(b.layers,h.hitch(this,function(b){var a={};"undefined"!==typeof b.labelingInfo&&k.forEach(b.labelingInfo,h.hitch(this,function(d){"undefined"!==typeof d.name&&(a.layer=b.id,a.name=d.name,a.labelingInfo=d,a.expression=
d.labelExpressionInfo.expression)}));1<Object.keys(a).length&&a.constructor===Object?f.push(a):f.push({layer:b.id,name:null,labelingInfo:null,expression:null})}));return f};g.customExpr={};g.customExpr.getAttributesFromCustomArcadeExpr=function(b,f,e){b=g.InfoTemplate._parseArcadeExpressions(b);return g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(f,b,e)};g.customExpr.getAttributesValueFromCustomArcadeExprBatch=function(b,f,e){var a=[],d;for(d in f)a.push(f[d]);f=g.InfoTemplate._parseArcadeExpressions(b);
b=g.InfoTemplate._getExprNamesArrayFromPopupExprInfos(b);b.relationships=null;b.parsedExpressions=f;var c=new r;g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(a,b,e).then(function(a){c.resolve(a)});return c};g.InfoTemplate={};g.InfoTemplate.getAttributesFromInfoTemplate=function(b,f,e){var a={fields:[]};f.layerObject&&f.layerObject.fields&&(a.fields=f.layerObject.fields);b=g.readExprInfo.getArcadeProfilesByType(b,f,"infoTemplate")[0].expressionInfos;if(!b)return e.attributes;b=g.InfoTemplate._parseArcadeExpressions(b);
return g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(e,b,a)};g.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(b,f,e){var a={fields:[]};f.layerObject&&f.layerObject.fields&&(a.fields=f.layerObject.fields);var d=[],c;for(c in e)d.push(e[c]);b=g.readExprInfo.getArcadeProfilesByType(b,f,"infoTemplate")[0].expressionInfos;var h=new r;if(!b)return h.resolve([]),h;e=g.InfoTemplate._parseArcadeExpressions(b);c=null;c=f.getPopupInfo().description;null!==c?(c=g.InfoTemplate._convertPopupDescToFieldNamesArray(c),
c.relationships=g.InfoTemplate._getRelationshipQueries(f)):(c=g.InfoTemplate._getExprNamesArrayFromPopupExprInfos(b),c.relationships=null);c.parsedExpressions=e;g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(d,c,a).then(function(a){h.resolve(a)});return h};g.InfoTemplate._getRelationshipQueries=function(b){var f=!1,e={},a=/\d+/,d;if(d=b.getPopupInfo().description.match(/\{relationships\/\d+\//gm))f=!0,k.forEach(d,function(c){var d=c.match(a)[0];e.hasOwnProperty(d)||(c=new u,c.outFields=["*"],
c.relationshipId=d,c.returnGeometry=!1,e[d]={operLayer:b,relatedQuery:c})});return f?e:null};g.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(b){var f=[],e;for(e in b)f.push("${expression/"+b[e].name+"}");return f};g.InfoTemplate._convertPopupDescToFieldNamesArray=function(b){b=g.InfoTemplate._convertEndParasToEOLs(b);b=g.InfoTemplate._convertBreaksToEOLs(b);b=g.InfoTemplate._sanitizeNoTags(b).trim();b=b.replace(/\{/gi,"${");b=b.replace(/\u00a0/gi," ");b=b.split("\n");return b=k.map(b,
function(b){return b.trim()})};g.InfoTemplate._sanitizeNoTags=function(b){var f;f=v.sanitizeHTML(b);b=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;var e;do e=f,f=f.replace(b,"");while(f!==e);return f=f.replace(/</g,"\x26lt;")};g.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=function(b,f,e){var a=new r,d=[],c=[],h=0;f.relationships?(k.forEach(b,function(a){g.InfoTemplate._objEach(f.relationships,
function(d,b){var h=new r,l=d.relatedQuery,q;c.push(h);q=a.attributes[d.operLayer.layerObject.objectIdField];l.objectIds=[q];d.operLayer.layerObject.queryRelatedFeatures(l,function(c){var d=[];c[q]&&c[q].features&&(c=c[q].features,k.forEach(c,function(c){var p=[],h,l,q;h=a.attributes;l="relationships/"+b+"/";g.InfoTemplate._objEach(c.attributes,function(a,c){q=l+c;h[q]=a});k.forEach(f,function(c){p.push(n.substitute(c,g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,f.parsedExpressions,
e),g.InfoTemplate._useEmptyStringForNull))});d.push(p)}));h.resolve(d)})})}),t(c).then(function(c){k.forEach(c,function(a){k.forEach(a,function(a){++h;d.push(a)})});console.log(h+" related address features found");a.resolve(d)})):(k.forEach(b,function(a){var c=[];k.forEach(f,function(d){c.push(n.substitute(d,g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,f.parsedExpressions,e),g.InfoTemplate._useEmptyStringForNull))});d.push(c)}),a.resolve(d));return a};g.InfoTemplate._parseArcadeExpressions=
function(b){var f;Array.isArray(b)&&0<b.length&&(f={},k.forEach(b,function(b){f[b.name]=l.parseScript(b.expression)}));return f};g.InfoTemplate._initArcadeContext=function(b,f){var e={vars:{}};e.vars.$feature=q.createFromGraphicLikeObject(b.geometry,b.attributes,f);return e};g.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(b,f,e){var a,d;a=h.mixin({},b.attributes);if(f)for(d in b=g.InfoTemplate._initArcadeContext(b,e),f)e=l.executeScript(f[d],b),a["expression/"+d]=e?e.toString():
"";return a};g.InfoTemplate._convertEndParasToEOLs=function(b){var f=b;b=b.match(/<\/p>/gi);k.forEach(b,function(b){f=f.replace(b,"\n")});return f};g.InfoTemplate._convertBreaksToEOLs=function(b){var f=b;b=b.match(/<br\s*\/?>/gi);k.forEach(b,function(b){f=f.replace(b,"\n")});return f};g.InfoTemplate._useEmptyStringForNull=function(b){return b?b:""};g.InfoTemplate._objEach=function(b,f,e){for(var a in b)b.hasOwnProperty(a)&&f.call(e,b[a],a)};return g})},"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils jimu/utils esri/graphic".split(" "),
function(k,h,r,t,n,l,q,u,v,w,g,b,f,e){function a(a,c){if(!a||!a.length)return c||[];if(!c||!c.length)return a;for(var d=[],b=0,f=a.length;b<f;b++)for(var e=a[b],g=0,h=c.length;g<h;g++){var k=c[g];if(k.name===e.name){k.alias!==e.alias&&(e.alias=k.alias);d.push(e);break}}return d}l.readLayerInfosObj=function(a){return r.getInstance(a,a.itemInfo)};l.readLayerInfosFromMap=function(a,c,b){var d=new t;r.getInstance(a,a.itemInfo).then(k.hitch(this,function(a){var f=[];c?a.traversalLayerInfosOfWebmap(function(a){f.push(a)}):
a.traversal(function(a){f.push(a)});if(b){var e=[],g=a.getMapNotesLayerInfoArray();h.forEach(g,function(a){e.push(a.id);a.traversal(function(a){e.push(a.id)})});f=h.filter(f,function(a){return-1===e.indexOf(a.id)})}a=a.getTableInfoArray();f=f.concat(a);d.resolve(f)}),k.hitch(this,function(a){console.error(a);d.reject(a)}));return d.promise};l.generateColumnsFromFields=function(a,c,b,e,g,q,n,v){function d(a){if(p&&w.isDefined(p.fieldInfos))for(var c=0,d=p.fieldInfos.length;c<d;c++){var b=p.fieldInfos[c];
if(b.fieldName===a)return b.format}return null}var p=c.getPopupInfo(),B={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,filed:"selection-handle-column",sortable:!1,_cache:{sortable:!1,statistics:!1}}};h.forEach(b,k.hitch(l,function(b,p,r){p="field"+p;var E=!!b.domain,u="esriFieldTypeDate"===b.type,t=e&&b.name===e,z="esriFieldTypeDouble"===b.type||"esriFieldTypeSingle"===b.type||"esriFieldTypeInteger"===b.type||"esriFieldTypeSmallInteger"===b.type,M="esriFieldTypeString"===
b.type,x=0===b.name.indexOf("expression/"),m=b.alias||b.name,H;H=1===r.length?!1:a&&a[p]?a[p].hidden:b?!b.show&&w.isDefined(b.show):!1;B[p]={label:m,className:p,hidden:H,unhidable:1===r.length?!1:!b.show&&w.isDefined(b.show)&&b._pk,field:b.name,sortable:!1,_cache:{sortable:!!q,statistics:n&&!E&&z}};M?B[p].formatter=k.hitch(l,l.urlFormatter):u?B[p].formatter=k.hitch(l,l.dateFormatter,d(b.name)):z&&(B[p].formatter=k.hitch(l,l.numberFormatter,d(b.name)));E?B[p].get=k.hitch(l,function(a,c,b){return this.getCodeValue(a,
c.name,b)},v,b):t?B[p].get=k.hitch(l,function(a,c,b){return this.getTypeName(b[a.name],c)},b,g):x?(r=this.arcade.getExpressionInfosFromLayerInfo(c),E=f.getFeatureLayerDefinition(v),B[p]._cache.sortable=!1,B[p].get=k.hitch(l,function(a,c,b,d){return this.arcade.getAttributes(d,a,b)[c.name]||""},r,b,E)):E||u||t||x||(B[p].get=k.hitch(l,function(a,c,b,d,f){var e=null;b&&d&&0<d.length&&(d=(d=h.filter(d,k.hitch(l,function(a){return a.id===f[b]})))&&d[0]||null)&&d.domains&&d.domains[c.name]&&d.domains[c.name].codedValues&&
(e=this.getCodeValue(a,c.name,f));return(a=null!==e?e:f[c.name])||isFinite(a)?a:""},v,b,e,g))}));return B};l.getTypeName=function(a,c){return f.fieldFormatter.getTypeName(a,c)};l.getCodeValue=function(a,c,b){return(a=f.getDisplayValueForCodedValueOrSubtype(a,c,b))&&a.isCodedValueOrSubtype?a.displayValue||"":""};l.urlFormatter=function(a){return f.fieldFormatter.getFormattedUrl(a)};l.dateFormatter=function(a,c){return f.fieldFormatter.getFormattedDate(c,a)};l.numberFormatter=function(a,c){return f.fieldFormatter.getFormattedNumber(c,
a)};l.readLayerObjectsFromMap=function(a,c,b){var d=new t,f=[];this.readLayerInfosFromMap(a,c,b).then(k.hitch(this,function(a){h.forEach(a,k.hitch(this,function(a){f.push(a.getLayerObject())}));n(f).then(k.hitch(this,function(a){d.resolve(a)}),k.hitch(this,function(a){d.reject(a);console.error(a)}))}),k.hitch(this,function(a){d.reject(a)}));return d.promise};l.readSupportTableInfoFromLayerInfos=function(a){var c=new t,b=[];h.forEach(a,k.hitch(this,function(a){b.push(a.getSupportTableInfo())}));n(b).then(k.hitch(this,
function(b){b=k.clone(b);h.forEach(b,function(c,b){c.id=a[b].id});c.resolve(b)}),function(a){c.reject(a)});return c.promise};l.readConfigLayerInfosFromMap=function(a,c,b){var d=new t,f=[];this.readLayerInfosFromMap(a,c,b).then(k.hitch(this,function(a){var c=[];h.forEach(a,function(a){f.push(a.getSupportTableInfo())});n(f).then(k.hitch(this,function(b){h.forEach(b,k.hitch(this,function(b,d){b.isSupportedLayer&&(a[d].name=a[d].title,c.push(a[d]))}));d.resolve(c)}),k.hitch(this,function(a){d.reject(a)}))}),
k.hitch(this,function(a){d.reject(a)}));return d.promise};l.getConfigInfosFromLayerInfos=function(a){return h.map(a,function(a){return l.getConfigInfoFromLayerInfo(a)})};l.getConfigInfoFromLayerInfo=function(b){var c={};c.name=b.name||b.title;c.id=b.id;c.show=b.isShowInMap();c.layer={url:b.getUrl()};var d=b.getPopupInfo();d&&!d.description&&(c.layer.fields=h.map(d.fieldInfos,function(a){return{name:a.fieldName,alias:a.label,show:a.visible,format:a.format}}),b=k.getObject("layerObject.fields",!1,b),
c.layer.fields=a(c.layer.fields,b),h.some(c.layer.fields,function(a){return a.show})||(c.layer.fields&&0<c.layer.fields.length?c.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return c};l.generateCacheStore=function(a,c,b,f,e){a=new g({layer:a,objectIds:a._objectIds||null,totalCount:c,batchCount:b,where:f||"1\x3d1",spatialFilter:e});c=new v;return new u(a,c,{})};l.generateMemoryStore=function(a,c){return new q(new v({data:a||[],idProperty:c}))};l.merge=function(a,c,b,f){for(var d=
h.map(c,function(a){return a[b]}),e=0,g=a.length;e<g;e++){var k=d.indexOf(a[e][b]);-1<k&&f(a[e],c[k])}};l.syncOrderWith=function(a,c,b){function d(a,c){return h.map(a,function(a){return a[c]})}if(!k.isArray(c)||!b)return a;for(var f=d(a,b),e=[],g=0,l=c.length;g<l;g++){var q=f.indexOf(c[g][b]);-1<q&&(e=e.concat(a.splice(q,1)),f=d(a,b))}return e.concat(a)};l.arcade={};l.arcade.getExpressionInfosFromLayer=function(a,c){a=b.readExprInfo.getArcadeProfilesByType(a,c,"infoTemplate");return 0<a.length&&a[0].expressionInfos?
a[0].expressionInfos:[]};l.arcade.getExpressionInfosFromLayerInfo=function(a){return(a=a&&a.getPopupInfo())&&a.expressionInfos||[]};l.arcade.getAttributes=function(a,c,f){var d=new e(null,null,a);return b.customExpr.getAttributesFromCustomArcadeExpr(c,d,f)||a};l.arcade.appendArcadeExpressionsToFields=function(a,c){c=l.arcade.getExpressionInfosFromLayerInfo(c);if(0<c.length){var b=/^expression\//;h.forEach(c,function(c){h.some(a,function(a){if(b.test(a.name))return a=a.name.substr(11),c.name===a})||
a.push({name:"expression/"+c.name,alias:c.title,show:!0})})}return a};l.arcade.isArcadeExpressionField=function(a){return a&&"string"===typeof a.name&&0===a.name.indexOf("expression/")}})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(k,h){var r=function(r,n,l){l=l||{};return k.delegate(r,{query:function(h,k){h=r.query(h,k);h.forEach(function(h){l.isLoaded&&!l.isLoaded(h)||n.put(h)});return h},queryEngine:r.queryEngine||n.queryEngine,get:function(k,l){return h(n.get(k),
function(q){return q||h(r.get(k,l),function(h){h&&n.put(h,{id:k});return h})})},add:function(k,l){return h(r.add(k,l),function(h){n.add(h&&"object"==typeof h?h:k,l);return h})},put:function(k,l){n.remove(l&&l.id||this.getIdentity(k));return h(r.put(k,l),function(h){n.put(h&&"object"==typeof h?h:k,l);return h})},remove:function(k,l){return h(r.remove(k,l),function(h){return n.remove(k,l)})},evict:function(h){return n.remove(h)}})};k.setObject("dojo.store.Cache",r);return r})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),
function(k,h,r,t,n,l){return k(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(h){k.safeMixin(this,h);this.data=[];this._entityData=[];this.layer=h.layer;this.objectIds=h.objectIds;this.where=h.where;this.orderByFields=h.orderByFields;this.totalCount=h.totalCount;this.batchCount=h.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=h.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new n(this.layer.url))},get:function(h){return this.data[h]},
getIdentity:function(h){return h[this.idProperty]},query:function(k,n){var q=new t,u=n&&n.start||0,g=n._export_count||this.batchCount,b=null;"function"===typeof k?b=k(this._entityData):"[object Array]"===Object.prototype.toString.call(k)&&(b=k);this.objectIds?(b=b?b:this.objectIds,q.objectIds=b.length>=u+this.batchCount?b.slice(u,u+g):b.slice(u)):(b&&0<b.length?q.objectIds=b.length>=u+this.batchCount?b.slice(u,u+g):b.slice(u):(q.start=u,q.num=g,q.where=this.where,q.geometry=this.spatialFilter,q.spatialRelationship=
t.SPATIAL_REL_INTERSECTS),(k=n.sort)&&0<k.length&&(k=r.map(k,function(b){return b.attribute+" "+(b.descending?"DESC":"ASC")}),q.orderByFields=k));q.returnGeometry="esriGeometryPoint"===this.layer.geometryType;q.outFields=["*"];var f=this.totalCount;k=null;k=!q.where;if(!(q.objectIds&&0<q.objectIds.length)&&k)return new l([]);k=this.queryTask?this.queryTask.execute(q):this.layer.queryFeatures(q);k.total=k.then(h.hitch(this,function(b){var a=0,d=this.layer.objectIdField;if(this.objectIds){if(!d)for(a=
0;a<b.fields.length;a++)if("esriFieldTypeOID"===b.fields[a].type){d=b.fields[a].name;break}for(var c={},a=0;a<b.features.length;a++)c[b.features[a].attributes[d]]=b.features[a];b.features=r.map(q.objectIds,function(a){return c[a]})}for(a=0;a<b.features.length;a++)if(b.features[a]){var e=b.features[a];b.features[a]=h.mixin(h.clone(e.attributes),{geometry:e.geometry});this.data[b.features[a][d]]=b.features[a];this._entityData.push(b.features[a])}b=b.features;return f}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");
return 0});return new l(k)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(k,h,r,t){var n=function(l){function q(h){l[h]||(l[h]=function(){var k=arguments;return t.when(l,function(l){Array.prototype.unshift.call(k,l.features||l);return n(r[h].apply(r,k))})})}if(!l)return l;l.then&&(l=h.delegate(l));l.total||(l.total=t.when(l,function(h){return k._isDefined(h.total)?
h.total:h.length||0}));q("forEach");q("filter");q("map");q("some");q("every");return l};return n})},"widgets/AttributeTable/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:dijit/layout/templates/TabContainer.html":'\x3cdiv class\x3d"dijitTabContainer"\x3e\r\n\t\x3cdiv class\x3d"dijitTabListWrapper" data-dojo-attach-point\x3d"tablistNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"tablistSpacer" class\x3d"dijitTabSpacer ${baseClass}-spacer"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTabPaneWrapper ${baseClass}-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/_TabButton.html":'\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"titleNode,innerDiv,tabContent" class\x3d"dijitTabInner dijitTabContent"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTabButtonIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d\'containerNode,focusNode\' class\x3d\'tabLabel\'\x3e\x3c/span\x3e\r\n\t\x3cspan class\x3d"dijitInline dijitTabCloseButton dijitTabCloseIcon" data-dojo-attach-point\x3d\'closeNode\'\r\n\t\t  role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d\'closeText\' class\x3d\'dijitTabCloseText\'\x3e[x]\x3c/span\r\n\t\t\t\t\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/layout/templates/ScrollingTabController.html":'\x3cdiv class\x3d"dijitTabListContainer-${tabPosition}" style\x3d"visibility:hidden"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerMenuButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_menuBtn"\r\n\t\t data-dojo-props\x3d"containerId: \'${containerId}\', iconClass: \'dijitTabStripMenuIcon\',\r\n\t\t\t\t\tdropDownPosition: [\'below-alt\', \'above-alt\']"\r\n\t\t data-dojo-attach-point\x3d"_menuBtn" showLabel\x3d"false" title\x3d""\x3e\x26#9660;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_leftBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideLeftIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_leftBtn" data-dojo-attach-event\x3d"onClick: doSlideLeft"\x3e\x26#9664;\x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit.layout._ScrollingTabControllerButton"\r\n\t\t class\x3d"tabStripButton-${tabPosition}"\r\n\t\t id\x3d"${id}_rightBtn"\r\n\t\t data-dojo-props\x3d"iconClass:\'dijitTabStripSlideRightIcon\', showLabel:false, title:\'\'"\r\n\t\t data-dojo-attach-point\x3d"_rightBtn" data-dojo-attach-event\x3d"onClick: doSlideRight"\x3e\x26#9654;\x3c/div\x3e\r\n\t\x3cdiv class\x3d\'dijitTabListWrapper\' data-dojo-attach-point\x3d\'tablistWrapper\'\x3e\r\n\t\t\x3cdiv role\x3d\'tablist\' data-dojo-attach-event\x3d\'onkeydown:onkeydown\'\r\n\t\t\t data-dojo-attach-point\x3d\'containerNode\' class\x3d\'nowrapTabStrip\'\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/layout/templates/_ScrollingTabControllerButton.html":'\x3cdiv data-dojo-attach-event\x3d"ondijitclick:_onClick" class\x3d"dijitTabInnerDiv dijitTabContent dijitButtonContents"  data-dojo-attach-point\x3d"focusNode" role\x3d"button"\x3e\r\n\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitTabStripIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3cspan data-dojo-attach-point\x3d"containerNode,titleNode" class\x3d"dijitButtonText"\x3e\x3c/span\x3e\r\n\x3c/div\x3e',
"url:widgets/AttributeTable/css/style.css":'.jimu-widget-attributetable-main .tabStripButton{height: 24px !important;}.jimu-widget-attributetable,.jimu-widget-attributetable-main{left: 0px; bottom: 0px; background-color: #efefef;}.jimu-widget-attributetable{height: auto;}.jimu-widget-attributetable-main{overflow: hidden; width: 100%; height: 100%;}.jimu-widget-attributetable .jimu-widget-attributetable-main .dijitToolbar {position: relative;}.jimu-widget-attributetable-move{width: 100%; height: 7px; top: 0px; background-color: rgba(0, 0, 0, 0.7);}.jimu-widget-attributetable-move:hover{cursor: n-resize;}.jimu-widget-attributetable-move:hover .jimu-widget-attributetable-thumb{background-color: #fff;}.jimu-widget-attributetable .draging{background-color: gray;}.jimu-widget-attributetable-thumb{background: #B0B0B0 none; height: 1px; width: 19px; margin: 3px auto; position: absolute; left: 0; right: 0;}.jimu-widget-attributetable-indicate-vertical{width: 2px; height: 100%; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-indicate-horizontal{width: 100%; height: 2px; background-color: black; position: absolute; z-index: 1; opacity: 0;}.jimu-widget-attributetable-switch{width: 63px; height: 17px; left: 0; right: 0; top: -17px; margin: auto; position: absolute; cursor: pointer; border-radius: 8px 8px 0 0; background-position: center; background-repeat: no-repeat; background-color: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.8); border-bottom-style: none;}.jimu-widget-attributetable-switch.open{background-image: url(images/arrow_down.svg); border-bottom-left-radius: 0; border-bottom-right-radius: 0;}.jimu-widget-attributetable-switch.open:hover{background-image: url(images/arrow_down_hover.svg);}.jimu-widget-attributetable-switch.close{background-image: url(images/arrow_up.svg)}.jimu-widget-attributetable-switch.close:hover{background-image: url(images/arrow_up_hover.svg);}.jimu-widget-attributetable-arrowImage{width: 30px; height: 30px; left: 48%; top: -30px; position: absolute; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-position: center center; background-repeat: no-repeat; cursor: ns-resize; background-color: rgba(0, 0, 0, 0.8);}.dijitTabPaneWrapper .dijitTabContainerTop-container .dijitAlignCenter{height: 100%;}.jimu-widget-attributetable .dijitTabContainerTopChildWrapper,.jimu-widget-attributetable .dijitTabContainerTopChildWrapper .dijitContentPane{height: 100% !important; width: 100% !important; padding: 0;}.jimu-widget-attributetable .dijitToggleButton.dijitToggleButtonChecked .dijitButtonText{color: #518dca;}.jimu-widget-attributetable .esriAttributeTable{width: 100%; height: 100%; position: relative;}.jimu-widget-attributetable .dgrid-header .dgrid-column-selectionHandle.selection-handle-column div.dgrid-resize-header-container{display: none;}.jimu-widget-attributetable .dgrid-column-selectionHandle.selection-handle-column{width: 20px !important; background-color: #eee; padding: 0 !important; border-bottom: 1px solid #ccc !important; cursor: pointer;}.dojoDndSource.dojoDndTarget.dojoDndHorizontal.dojoDndContainer .dgrid-column-selectionHandle.selection-handle-column{pointer-events: none;}.jimu-widget-attributetable .dgrid-cell {border-right: solid 1px #ccc; width: 100px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table.auto-width .dgrid-cell{width: auto;}.jimu-widget-attributetable .dgrid-row .dgrid-cell {border:medium none; padding: 7px 3px; border-right: 1px solid #CCCCCC;}.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {right: 0; left: 17px;}.has-webkit.jimu-rtl .jimu-widget-attributetable .dgrid-rtl-swap .dgrid-header-row {left: 6px;}.dj_edge.jimu-rtl .jimu-widget-attributetable .dgrid-header-row {left: 16px; right: 0;}.dj_edge.jimu-rtl .dgrid-header-scroll,.dj_edge.jimu-rtl .dgrid-hider-toggle {right: auto; left: 0;}.dj_edge.jimu-rtl .dgrid-hider-menu {left: 17px; right: auto;}.jimu-rtl .jimu-widget-attributetable .dgrid-cell {text-align: right; border-left: solid 1px #ccc;}.jimu-widget-attributetable .dgrid-header {overflow: hidden; background-color: #eee;}.jimu-widget-attributetable .dgrid-header.dgrid-scrollbar-width {min-width: 16px;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-right-color: transparent;}.jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child .dgrid-resize-handle {display: none;}.jimu-rtl .jimu-widget-attributetable .dgrid-header .dgrid-cell:last-child {border-left-color: transparent;}.jimu-widget-attributetable .dgrid-cell a{color: #21759B; text-decoration: none;}.jimu-widget-attributetable .dgrid-cell a:hover, a:active{text-decoration: underline;}.jimu-widget-attributetable .dgrid-row {border: medium none;}.jimu-widget-attributetable .dgrid-row:hover {background-color:#E1F0FB;}.jimu-widget-attributetable .dgrid-row-even{background-color: #FFF;}.jimu-widget-attributetable .dgrid-row-odd {background-color: #F7F8F8;}.jimu-widget-attributetable .ui-state-active {background-color: rgb(0, 255, 255) !important;}.jimu-widget-attributetable .dgrid-status {white-space: pre;}.jimu-widget-attributetable .self-footer {display: inline-block;}.jimu-rtl .dgrid-hider-menu-check{right: 2px; left: auto;}.jimu-rtl .dgrid-hider-menu-label {padding-left: 0; padding-right: 20px;}.jimu-rtl .jimu-widget-attributetable .dgrid-pagination .dgrid-status{float: right !important;}.jimu-rtl .dgrid-pagination .dgrid-navigation,.jimu-rtl .dgrid-pagination .dgrid-page-size{float: left !important;}.esriAttributeTableExportImage{background-image: url("../images/export.png"); width: 13px; height: 13px;}.esriAttributeTableZoomImage{background-image: url("../images/zoom.png"); width: 13px; height: 13px;}.esriAttributeTableSelectAllImage{background-image: url("../images/select.png"); width: 13px; height: 13px;}.esriAttributeTableFilterImage{background-image: url("../images/filter.png"); width: 13px; height: 13px;}.esriAttributeTableSelectPageImage{background-image: url("../images/page.png"); width: 13px; height: 13px;}.esriAttributeTableClearImage{background-image: url("../images/clear.png"); width: 13px; height: 13px;}.esriAttributeTableOptionsImage{background-image: url("../images/more.png"); width: 13px; height: 13px;}.esriAttributeTableRefreshImage{background-image: url("../images/refresh.png"); width: 13px; height: 13px;}.esriAttributeTableSymbolImage{background-image: url("../images/symbol.png"); width: 13px; height: 13px;}.esriAttributeTableCloseImage{background-image: url("../images/close.png"); width: 13px; height: 13px; position: absolute; right: 0; top: -13px;}.esriAttributeTableColumnsImage{background-image: url("../images/columns.png"); width: 13px; height: 13px;}.jimu-rtl .jimu-widget-attributetable .close-button {right: auto; left: 0;}.jimu-widget-attributetable .jimu-loading-indicator {z-index: 100;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table{height: 100%; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column{overflow: visible; text-align: center;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos{text-align: center; display: inline-block; position: relative;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div{display: inline-block; color: #24B5CC; cursor: pointer; padding: 2px 10px; height: 20px; border-radius: 10px; line-height: 16px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments:hover,.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .show-attachments-div.has-attachments.selected{background: #24B5CC; color: white;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{display: none; position: absolute; background: #FFFFFF; box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.50); border-radius: 2px; width: 240px; left: -245px; top: 4px; text-align: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup{left: auto; right: -245px; text-align: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup.show{display: block;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{background: none; padding-left: 10px; font-size: 14px; color: #000000; font-weight: bold; line-height: 36px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header{padding-left: 0; padding-right: 10px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header:hover{background: #fff;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-header .close {display: inline-block; width: 36px; height: 36px; background: url(\'../images/close.png\') center no-repeat; cursor: pointer;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{box-sizing: border-box; width: 100%; max-height: 160px; list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; overflow-y: auto; padding-left: 20px;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content{padding-left: 0; padding-right: 20px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li {vertical-align: middle; background-image: url(\'./images/file.png\'); background-repeat: no-repeat; padding-left: 30px; background-size: 20px; background-position: left;}.jimu-rtl .jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li{padding-left: 0; padding-right: 30px; background-position: right;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li.image-type{background-image: url(\'./images/image.png\');}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a{display: inline-block; width: 176px; height: 36px; line-height: 36px;}.jimu-widget-attributetable .jimu-widget-attributetable-feature-table .attachments-column .attachment-infos .attachment-popup-content li a:hover{cursor: pointer;}.jimu-widget-attributetable-feature-menu .menuItemClass{cursor: pointer;}.jimu-widget-attributetable-feature-menu.dijitMenu{background-color: #fff !important;}.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected td,.jimu-widget-attributetable-feature-menu.dijitMenu .dijitMenuItemSelected{background-color: #f1f1f1 !important; color: #000!important;}.jimu-widget-attributetable-feature-table-footer {position: absolute; bottom: 4px; background: white; width: 100%;}.widget-at-filter-popup .content-absolute{left: 0; right: 0;}.jimu-widget-attributetable-feature-table-popup p {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup strong {font-family: "Avenir Medium";}.jimu-widget-attributetable-feature-table-popup mark {display: inline-block; color: #596679; background: #f1f1f1; border-bottom: 1px solid #ddd; margin: 5px; padding: 5px; font-size: 12px;}.jimu-widget-attributetable-feature-table-popup pre {padding: 5px; white-space: normal; font-size: 13px; color: #595959; background-color: #f8f8f8; border: 1px solid #efefef; margin: 10px 0 15px;}.jimu-widget-attributetable-feature-table-popup .tags {margin-bottom: 10px;}.jimu-widget-attributetable-feature-table-popup .example-block {margin-top: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row {margin: 20px auto; color: #596679;}.jimu-widget-attributetable-feature-table-popup .input-row \x3e * {vertical-align: top;}.jimu-widget-attributetable-feature-table-popup .input-row a {color: #485566; cursor: pointer; line-height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-attributetable-feature-table-popup .input-row a {margin-left: auto; margin-right: 10px;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button {font-size: 12px; color: #999;}.jimu-widget-attributetable-feature-table-popup .input-row a.hint-button:hover {color: #595959;}.jimu-widget-attributetable-notable {color: #999; line-height: 1.5; position: absolute; top: 50%; left: 50%; text-align: center; max-width: 400px; transform: translate(-50%, -50%);}.jimu-widget-attributetable-notable.hidden {display: none;}.closed .jimu-widget-attributetable-notable {display: none;}',
"*now":function(k){k(['dojo/i18n!*preload*widgets/AttributeTable/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetsInTemplateMixin jimu/BaseWidget dijit/layout/TabContainer dijit/layout/ContentPane jimu/utils jimu/dijit/Message dojo/Deferred dojo/promise/all esri/layers/FeatureLayer esri/lang dojo/_base/lang dojo/on dojo/keys dojo/touch dojo/topic dojo/aspect dojo/_base/array dojo/query jimu/dijit/LoadingIndicator jimu/FilterManager ./_ResourceManager ./utils".split(" "),function(k,h,r,t,n,l,q,u,v,w,g,b,f,e,a,d,c,x,z,F,J,G,K,D){k=k([t,r],{name:"AttributeTable",
baseClass:"jimu-widget-attributetable",normalHeight:0,openHeight:0,arrowDivHeight:null,_relatedDef:null,_resourceManager:null,_activeLayerInfoId:null,_layerTypes:{FEATURELAYER:"FeatureLayerTable",RELATIONSHIPTABLE:"RelationshipTable"},postMixInProperties:function(){this.nls.features=this.nls.features||"features"},postCreate:function(){this.inherited(arguments);h.setAttr(this.domNode,"aria-label",this.nls._widgetLabel);q.loadStyleLink("dgrid",apiUrl+"dgrid/css/dgrid.css");this.NoTableMessageDiv=this.AttributeTableDiv=
this._loadInfoDef=null;this._delayedLayerInfos=[];this.layerTabPages=[];this.tabContainer=null;this.moveMode=!1;this.bottomPosition=this.noGridHeight=this.previousDomHeight=this.moveY=0;this.layerTabPagesIndex=-1;this.showing=!1;this.openHeight=this.normalHeight=this._getNormalHeight();this.arrowDivHeight=0;this._dragingHandlers=[];this._activeTable=null;this._activeTableHandles=[];this.filterManager=G.getInstance();this._createUtilitiesUI();this._resourceManager=new K({map:this.map,nls:this.nls});
this._resourceManager.setConfig(this.config);this.own(c.subscribe("changeMapPosition",f.hitch(this,this._onMapPositionChange)));D.readLayerInfosObj(this.map).then(f.hitch(this,function(a){this.domNode&&a&&(this.own(e(a,"layerInfosIsShowInMapChanged",f.hitch(this,this.onLayerInfosIsShowInMapChanged))),this.own(a.on("layerInfosChanged",f.hitch(this,this.onLayerInfosChanged))),this.own(a.on("layerInfosFilterChanged",f.hitch(this,this.onLayerInfosFilterChanged))))}));this.own(e(this.domNode,"keydown",
f.hitch(this,function(b){h.hasClass(b.target,this.baseClass)&&b.keyCode===a.ENTER&&(this.focusToDisplay=!1)})));this.focusToDisplay=!0;this.own(e(this.domNode,"focus",f.hitch(this,function(){q.isInNavMode()&&this.focusToDisplay&&10>h.getStyle(this.domNode,"height")&&this._switchTable()})));this.own(e(this.domNode,"blur",f.hitch(this,function(){q.isInNavMode()&&this.focusToDisplay&&this._switchTable()})))},_createUtilitiesUI:function(){this._createSwitchUI();this._createBarUI()},_createBarUI:function(){this.arrowDiv=
h.create("div");h.addClass(this.arrowDiv,"jimu-widget-attributetable-move");h.create("div",{"class":"jimu-widget-attributetable-thumb"},this.arrowDiv);h.place(this.arrowDiv,this.domNode);if(!this.arrowDivHeight){var a=h.getMarginBox(this.arrowDiv);this.arrowDivHeight=a&&a.h?a.h:7}this.own(e(this.arrowDiv,"mousedown",f.hitch(this,this._onDragStart)));this.own(e(this.arrowDiv,d.press,f.hitch(this,this._onDragStart)))},_isOnlyTable:function(){return this.closeable||!this.isOnScreen},_createSwitchUI:function(){this._isOnlyTable()||
(this.switchBtn=h.create("div",{className:"jimu-widget-attributetable-switch",tabindex:"0"},this.domNode),q.initFirstFocusNode(this.domNode,this.switchBtn),this.own(e(this.switchBtn,"click",f.hitch(this,this._switchTable))),this.own(e(this.switchBtn,"keydown",f.hitch(this,function(b){b.keyCode===a.ENTER&&(this._switchTable(),this.focusToDisplay=this.showing?!1:!0)}))))},_processOpenBarUI:function(){this._isOnlyTable()||(h.removeClass(this.switchBtn,"close"),h.addClass(this.switchBtn,"open"),h.setAttr(this.switchBtn,
"title",this.nls.closeTableTip))},_processCloseBarUI:function(){this._isOnlyTable()||(h.removeClass(this.switchBtn,"open"),h.addClass(this.switchBtn,"close"),h.setAttr(this.switchBtn,"title",this.nls.openTableTip))},_switchTable:function(){this.showing?this._closeTable():this._openTable()},_openTable:function(){h.removeClass(this.domNode,"closed");this._loadInfoDef?this._loadInfoDef&&this._loadInfoDef.isFulfilled()&&(this.showing=!0,this._processDelayedLayerInfos(),this._activeTable&&this._activeTable.active()):
(this._loadInfoDef=new v,this.own(this._loadInfoDef),this.loading||(this.loading=new J),this.loading.placeAt(this.domNode),this.loading.show(),this._resourceManager.updateLayerInfoResources(!0).then(f.hitch(this,function(){this.domNode&&(this._init(),this.showRefreshing(!1),this.showing=!0,this._loadInfoDef.resolve())}),f.hitch(this,function(a){console.error(a);this._loadInfoDef.reject(a)})));this._changeHeight(this.openHeight);this._processOpenBarUI();return this._loadInfoDef},_onCloseBtnClicked:function(){this.showing&&
this._isOnlyTable()?this.widgetManager.closeWidget(this):this.showing&&this._closeTable();this._activeTable&&this._activeTable.deactive()},_closeTable:function(){h.addClass(this.domNode,"closed");this._changeHeight(0);this.showRefreshing(!1);this._processCloseBarUI();this._activeTable&&this._activeTable.deactive();this.showing=!1;h.setStyle(this.arrowDiv,"display","none");h.setStyle(this.domNode,"overflow","hidden");setTimeout(f.hitch(this,function(){this.domNode&&(h.setStyle(this.domNode,"overflow",
"visible"),h.setStyle(this.arrowDiv,"display","block"))}),10)},_init:function(){this.initDiv();this._changeHeight(this.openHeight);this.resize();this.own(e(window.document,"mouseup",f.hitch(this,this._onDragEnd)));this.own(e(window.document,"mousemove",f.hitch(this,this._onDraging)));this.own(e(window.document,d.move,f.hitch(this,this._onDraging)));this.own(e(window.document,d.release,f.hitch(this,this._onDragEnd)))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(z.forEach(this._delayedLayerInfos,
f.hitch(this,function(a){this._resourceManager.addLayerInfo(a)})),this._delayedLayerInfos=[])},onLayerInfosIsShowInMapChanged:function(a){this._activeTable&&this._activeTable.changeToolbarStatus();this.config.syncWithLayers&&z.forEach(a,f.hitch(this,function(a){if(!a.getSubLayers().length){var b=a.isShowInMap(),c=D.getConfigInfoFromLayerInfo(a),d=this.getExistLayerTabPage(c.id);if(b)if(d)d.closable&&d.set("closable",!1);else{var e=this._resourceManager.getVisivleLayerInfoIndexById(a.id),b=this._resourceManager.getLayerInfoById(a.id),
h={layer:a,closeable:!1,isActive:!1,index:e};b?this._addLayerToTable(h):this._resourceManager.updateLayerInfoResources(!1).then(f.hitch(this,function(){e=this._resourceManager.getVisivleLayerInfoIndexById(a.id);h.index=e;this._addLayerToTable(h)}))}else d&&this.layerTabPageClose(c.id,!0)}}))},onLayerInfosChanged:function(a,b,c){c&&a&&("added"===b?c.getSupportTableInfo().then(f.hitch(this,function(a){a.isSupportedLayer&&this._resourceManager.addLayerInfo(c)})):"removed"===b&&(a=c.id,this.getExistLayerTabPage(a)&&
this.layerTabPageClose(a,!0),this._resourceManager.getLayerInfoById(a)&&this._resourceManager.removeLayerInfo(a),this._resourceManager.getConfigInfoById(a)&&this._resourceManager.removeConfigInfo(a)))},onLayerInfosFilterChanged:function(a){z.some(a,f.hitch(this,function(a){if(this._activeTable&&a.id===this._activeTable.layerInfo.id)return this._activeTable._relatedQuery||this._activeTable.startQuery(),!0}))},destroy:function(){if(!this._destroyed){var a,c;if(this.layerTabPages&&0<this.layerTabPages.length){a=
this.layerTabPages.length;for(c=0;c<a;c++){var d=this.layerTabPages[c].paneId,e=f.getObject("_resourceManager.featureTableSet."+d,!1,this);e&&(e=e.getFilterObj())&&b.isDefined(e.expr)&&this.filterManager.applyWidgetFilter(d,this.id,"");this.layerTabPages[c].destroy()}this.layerTabPages=null}this.tabContainer&&(this.tabContainer.destroy(),this.tabContainer=null);this._activeLayerInfoId=this._loadInfoDef=this.AttributeTableDiv=null;this._resourceManager&&this._resourceManager.empty();this.inherited(arguments)}},
onOpen:function(){!this.showing&&this._isOnlyTable()&&this._openTable()},onClose:function(){this.showing&&this._closeTable()},_changeHeight:function(a){h.setStyle(this.domNode,"height",a+"px");this.tabContainer&&this.tabContainer.domNode&&0<=a-this.arrowDivHeight&&h.setStyle(this.tabContainer.domNode,"height",a-this.arrowDivHeight+"px");this._activeTable&&this._activeTable.changeHeight(a-this.noGridHeight);c.publish("changeMapPosition",{bottom:a+this.bottomPosition});this.publishData({changeMapPosition:{bottom:a+
this.bottomPosition}});0!==a&&(this.openHeight=a>=this.arrowDivHeight?a:this.normalHeight)},_onMapPositionChange:function(a){isFinite(a.left)&&"number"===typeof a.left&&(window.isRTL?h.setStyle(this.domNode,"right",parseFloat(a.left)+"px"):h.setStyle(this.domNode,"left",parseFloat(a.left)+"px"));isFinite(a.right)&&"number"===typeof a.right&&(window.isRTL?h.setStyle(this.domNode,"left",parseFloat(a.right)+"px"):h.setStyle(this.domNode,"right",parseFloat(a.right)+"px"));this.tabContainer&&this.tabContainer.resize()},
setPosition:function(a){this.position=a;this._isOnlyTable()?this.bottomPosition=0:this.bottomPosition="bottom"in a?parseInt(a.bottom,10):0;this.domNode.parentNode&&this.domNode.parentNode.id===window.jimuConfig.layoutId||(h.place(this.domNode,window.jimuConfig.layoutId),this.setInitialPosition(a),this.showRefreshing(!1));h.setStyle(this.domNode,"bottom",this.bottomPosition+"px");this._resourceManager.isEmpty()||setTimeout(f.hitch(this,function(){var a=this._getGridTopSectionHeight(),b=h.getStyle(this.domNode,
"height");0<a&&(this.noGridHeight=a);0<b&&this._changeHeight(b)}),20)},_startQueryOnLayerTab:function(a,b){var c=this._resourceManager.getLayerInfoById(a),d=this.getExistLayerTabPage(a);c&&d&&(this.showRefreshing(!0),this._resourceManager.getQueryTable(a,this.config.filterByMapExtent,this.config.hideExportButton,this.config.allowTextSelection).then(f.hitch(this,function(c){this._activeLayerInfoId===a&&c&&(d=this.getExistLayerTabPage(a),c.isSupportQuery?(c=c.table,c.getParent()!==d&&c.placeAt(d),this.setActiveTable(c,
{h:this.openHeight-this.noGridHeight,featureSet:b})):(c=h.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),d.set("content",c),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}),f.hitch(this,function(a){new u({message:a.message||a});this.showRefreshing(!1)})))},_startQueryOnRelationTab:function(a,b,c,d){var e=this._resourceManager.getLayerInfoById(d),g=this.getExistLayerTabPage(a);e&&e.layerObject&&g&&this._resourceManager.getRelationTable(d,b,
!1,this.config.hideExportButton,this.config.allowTextSelection).then(f.hitch(this,function(b){this._activeLayerInfoId===a&&b&&(g=this.getExistLayerTabPage(a),b.isSupportQuery?(b=b.table,b.getParent()!==g&&b.placeAt(g),this.setActiveTable(b,{h:this.openHeight-this.noGridHeight,layer:e.layerObject,selectedIds:c})):(b=h.toDom("\x3cdiv\x3e"+this.nls.unsupportQueryWarning+"\x3c/div\x3e"),g.set("content",b),this._activeTable&&this._activeTable.changeToolbarStatus()),this.showRefreshing(!1))}))},tabChanged:function(){if(this.tabContainer&&
this.tabContainer.selectedChildWidget){0>=this.noGridHeight&&(this.noGridHeight=this._getGridTopSectionHeight()+5);var a=this.tabContainer.selectedChildWidget.params,b=a.layerType,c=a.paneId,d=a.relKey;b===this._layerTypes.FEATURELAYER&&(this._activeLayerInfoId!==c||a.oids||a.featureSet)?(this.setActiveTable(null),delete a.oids,this._activeLayerInfoId=c,this._startQueryOnLayerTab(c,a.featureSet)):b===this._layerTypes.RELATIONSHIPTABLE&&(this.setActiveTable(null),b=a.oids,a=a.originalInfoId,this._activeLayerInfoId=
c,this._startQueryOnRelationTab(c,d,b,a))}},showRefreshing:function(a){this.loading&&(a?this.loading.show():this.loading.hide())},_onDragStart:function(a){this.moveMode=!0;this.moveY=a.clientY;this.previousDomHeight=h.getStyle(this.domNode,"height");h.addClass(this.arrowDiv,"draging");this._dragingHandlers=this._dragingHandlers.concat([e(this.ownerDocument,"dragstart",function(a){a.stopPropagation();a.preventDefault()}),e(this.ownerDocumentBody,"selectstart",function(a){a.stopPropagation();a.preventDefault()})])},
_onDraging:function(a){this.moveMode&&125<=a.clientY&&this._changeHeight(this.moveY-a.clientY+this.previousDomHeight)},_onDragEnd:function(){this.moveMode=!1;h.removeClass(this.arrowDiv,"draging");for(var a=this._dragingHandlers.pop();a;)a.remove(),a=this._dragingHandlers.pop()},_getNormalHeight:function(){var a=document.body.clientHeight;return window.appInfo.isRunInMobile?a/2:a/3},setInitialPosition:function(){h.setStyle(this.domNode,"top","auto");h.setStyle(this.domNode,"left","0px");h.setStyle(this.domNode,
"right","0px");h.setStyle(this.domNode,"position","absolute");this._isOnlyTable()||(this.config&&this.config.initiallyExpand?this._openTable():this._closeTable())},_bindActiveTableEvents:function(){var a=this;a._activeTable&&(a._activeTableHandles.push(e(a._activeTable,"show-related-records",function(b){a._showRelatedRecords(b.layerInfoId,b.objectIds)})),a._activeTableHandles.push(e(a._activeTable,"show-all-records",function(b){a.getExistLayerTabPage(b.layerInfoId).params.layerType=a._layerTypes.FEATURELAYER})),
a._activeTableHandles.push(e(a._activeTable,"refresh",function(b){delete a.getExistLayerTabPage(b.layerInfoId).params.featureSet})),a._activeTableHandles.push(e(a._activeTable,"apply-filter",function(b){a.filterManager.applyWidgetFilter(b.layerInfoId,a.id,b.expr);a._activeTable.startQuery()})))},_unbindActiveTableEvents:function(){for(var a=this._activeTableHandles;0<a.length;){var b=a.pop();b&&b.remove&&b.remove()}},setActiveTable:function(a,b){this._activeTable&&(this._activeTable.cancelThread(),
this._activeTable.deactive(),this._unbindActiveTableEvents(),this._activeTable=null);if(a){this._activeTable=a;this._activeTable.active();this._activeTable.changeHeight(b.h);if(!this._activeTable.tableCreated||this._activeTable.tableCreated&&this._activeTable.matchingMap||this._activeTable.tableCreated&&!this._activeTable.matchingMap&&b.featureSet||b.layer&&b.selectedIds)if(a=f.getObject("featureSet.features.length",!1,b),b.layer&&b.selectedIds)this._activeTable.queryRecordsByRelationship(b);else if(a){var c=
b.featureSet.displayFieldName;b=z.map(b.featureSet.features,function(a){return a.attributes[c]});this._activeTable.startQuery(b)}else this._activeTable.startQuery();this._bindActiveTableEvents();this._activeTable.changeToolbarStatus()}},initDiv:function(){this.AttributeTableDiv=h.create("div",{},this.domNode);h.addClass(this.AttributeTableDiv,"jimu-widget-attributetable-main");var a=h.create("div");h.place(a,this.AttributeTableDiv);this.tabContainer=new n({style:"width: 100%;"},a);h.setStyle(this.tabContainer.domNode,
"height",this.normalHeight+"px");this.tabContainer.startup();for(var a=this._resourceManager.getConfigInfos(),b=a.length,c=0;c<b;c++){var d=a[c];if(d.show){var d=f.clone(d),e={};e.paneId=d.id;e.title=d.name;e.name=d.name;e.layerType=this._layerTypes.FEATURELAYER;e.style="height: 100%; width: 100%; overflow: visible;";d=new l(e);this.layerTabPages[c]=d;this.tabContainer.addChild(d)}}0<b?this.noGridHeight=this._getGridTopSectionHeight()+5:this._toggleNoTableMessage(!0);q.setVerticalCenter(this.tabContainer.domNode);
this.tabChanged();this.own(x.after(this.tabContainer,"selectChild",f.hitch(this,this.tabChanged)))},getLayerInfoLabel:function(a){return a.name||a.title},getLayerInfoId:function(a){return a&&a.id||""},_getGridTopSectionHeight:function(){var a=F(".dijitTabPaneWrapper",this.domNode)[0];if(a){var b=h.position(this.domNode).y;return h.position(a).y-b}return 0},_getLayerInfoByIdFromConfigJSON:function(a){var b=z.filter(this.config.layerInfos,function(b){return b.id===a});return b&&0<b.length&&b[0]},_showRelatedRecords:function(a,
b){var c=this._activeTable;if(c&&(c=c.layerInfo)&&c.id===a&&c.layerObject){a=c.layerObject.relationships;for(var d=0,f=a.length;d<f;d++)this.addNewRelationTab(b,a[d],c.id,!0,!0)}},addNewLayerTab:function(a,b,c,d,h){var g=this._resourceManager.getLayerInfoById(a);if(g){a=this.getExistLayerTabPage(a);var k={};k.title=this.getLayerInfoLabel(g);k.name=k.title;k.paneId=this.getLayerInfoId(g);k.closable=c;k.layerType=this._layerTypes.FEATURELAYER;k.featureSet=b;a?(f.mixin(a.params,k),this.onOpen()):(this._resourceManager.getConfigInfoById(g.id)||
this._resourceManager.addConfigInfo(g),this._resourceManager.getLayerInfoById(g.id)||this._resourceManager.addLayerInfo(g),this.onOpen(),k.style="height: 100%; width: 100%; overflow: visible",a=new l(k),this.layerTabPages.push(a),a.set("title",k.name),this.own(e(a,"close",f.hitch(this,this.layerTabPageClose,k.paneId,!0))),this.tabContainer.addChild(a,h));d&&this.tabContainer.selectChild(a);1===this.layerTabPages.length&&this._toggleNoTableMessage(!1)}},addNewRelationTab:function(a,b,c,d,h){var g=
this._resourceManager.getRelationShipInfo(b),k=b&&g;if(k){var g=this.getExistLayerTabPage(g.id),p={};p.oids=a;p.title=k.title||k.name||b.name;p.name=p.title;p.paneId=k.id;p.relKey=b._relKey;p.originalInfoId=c;p.closable=d;p.layerType=this._layerTypes.RELATIONSHIPTABLE;g?f.mixin(g.params,p):(this._resourceManager.getConfigInfoById(k.id)||this._resourceManager.addConfigInfo(k),this._resourceManager.getLayerInfoById(k.id)||this._resourceManager.addLayerInfo(k),p.style="height: 100%; width: 100%; overflow: visible",
g=new l(p),this.layerTabPages.push(g),g.set("title",p.name),this.own(e(g,"close",f.hitch(this,this.layerTabPageClose,p.paneId,!0))),this.tabContainer.addChild(g));h&&this.tabContainer.selectChild(g)}},onReceiveData:function(a,b,c){c&&"AttributeTable"===c.target&&(this._isOnlyTable()&&"closed"===this.state?console.warn("Please open Attribute Table!"):(c.layer=c.layer||c.layerInfo,c.closeable=!0,c.isActive=!0,this.showing?this._resourceManager.updateLayerInfoResources(!1).then(f.hitch(this,function(){this._addLayerToTable(c)})):
this._openTable().then(f.hitch(this,function(){this._resourceManager.getLayerInfoById(c.layer.id)?this._addLayerToTable(c):this._resourceManager.updateLayerInfoResources(!1).then(f.hitch(this,function(){this._addLayerToTable(c)}))}))))},_addLayerToTable:function(a){var b=null;if(f.getObject("layer.id",!1,a)||f.getObject("layerInfo.id",!1,a)){var c=this._resourceManager.getLayerInfoById(a.layerInfo&&a.layerInfo.id||a.layer&&a.layer.id);c.getLayerObject().then(f.hitch(this,function(d){d?(d.id=a.layer.id,
d.loaded?this.addNewLayerTab(c.id,a.featureSet,!!a.closeable,!!a.isActive,a.index):this.own(e(d,"load",f.hitch(this,this.addNewLayerTab,c.id,a.featureSet,!!a.closeable,!!a.isActive,a.index)))):a.url&&(b=new g(a.url),this.own(e(b,"load",f.hitch(this,this.addNewLayerTab,c.id,a.featureSet,!!a.closeable,!!a.isActive,a.index))))}),f.hitch(this,function(a){new u({message:a.message||a})}))}},getExistLayerTabPage:function(a){for(var b=this.layerTabPages.length,c=0;c<b;c++)if(this.layerTabPages[c]&&this.layerTabPages[c].get("paneId")===
a)return this.layerTabPages[c];return null},layerTabPageClose:function(a,c){var d=this.layerTabPages.length;f.getObject("_activeTable.layerInfo.id",!1,this)===a&&this.setActiveTable(null);for(var e=0;e<d;e++)if(this.layerTabPages[e]&&this.layerTabPages[e].paneId===a){var g=f.getObject("_resourceManager.featureTableSet."+a,!1,this);g&&(g=g.getFilterObj())&&b.isDefined(g.expr)&&this.filterManager.applyWidgetFilter(a,this.id,"");!0===c&&(this.tabContainer.removeChild(this.layerTabPages[e]),this.layerTabPages[e].destroyRecursive());
this.layerTabPages&&this.layerTabPages[e]&&this.layerTabPages.splice(e,1);this._resourceManager.removeConfigInfo(a);this._resourceManager.removeLayerInfo(a);if(1===d){this._activeLayerInfoId=null;this.onClose();this._toggleNoTableMessage(!0);break}else a===this._activeLayerInfoId&&this.tabContainer.selectChild(this.layerTabPages[d-2]);break}},_processRelatedRecordsFromPopup:function(a,b){if(a){var c=[];c.push(a.getLayerObject());c.push(a.getRelatedTableInfoArray());w(c).then(f.hitch(this,function(c){if(c){var d=
c[0];this._resourceManager.collectRelationShips(a,c[1]);c=d.relationships;for(var d=0,e=c.length;d<e;d++)this.addNewRelationTab(b,c[d],a.id,!0,!0)}}))}},showRelatedRecordsFromPopup:function(a,b){this.showing?this._resourceManager.updateLayerInfoResources(!1).then(f.hitch(this,function(){this._processRelatedRecordsFromPopup(a,b)})):this._openTable().then(f.hitch(this,function(){this._resourceManager.getLayerInfoById(a.id)?this._processRelatedRecordsFromPopup(a,b):this._resourceManager.updateLayerInfoResources(!1).then(f.hitch(this,
function(){this._processRelatedRecordsFromPopup(a,b)}))}))},_toggleNoTableMessage:function(a){if(!this.NoTableMessageDiv){var b=this.AttributeTableDiv||this.domNode;this.NoTableMessageDiv=h.create("div",{innerHTML:this.nls.noTablesAvailable+"\x3cbr/\x3e\x3cbr/\x3e"+(this.config.syncWithLayers?this.nls.checkLayerListToSelectLayers:this.nls.checkConfigutationToSelectLayers),className:"jimu-widget-attributetable-notable hidden"});h.place(this.NoTableMessageDiv,b)}h[a?"removeClass":"addClass"](this.NoTableMessageDiv,
"hidden")}});k.inPanel=!1;k.hasUIFile=!1;return k});