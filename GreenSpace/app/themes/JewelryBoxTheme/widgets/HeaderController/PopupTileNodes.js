// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/dom-construct dojo/query dijit/_WidgetBase dijit/_TemplatedMixin jimu/dijit/ViewStack jimu/utils".split(" "),function(p,k,q,f,m,e,l,r,t,u,n){return p([r,t],{baseClass:"jimu-header-more-popup",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"pages" data-dojo-attach-point\x3d"pagesNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"points jimu-corner-bottom"\x3e\x3cdiv class\x3d"points-inner"data-dojo-attach-point\x3d"pointsNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
margin:4,postCreate:function(){this.nodes=[];this.pages=[];this.createCloseBtn()},startup:function(){this.viewStack=new u({views:[],viewType:"dom"},this.pagesNode);this.viewStack.startup();this.resize()},resize:function(){var a=this._calculateGridParam(),b;null!==a?(f.setStyle(this.domNode,n.getPositionStyle(a.position)),this.nodeWidth=a.cellSize-this.margin,this.oldGridParam&&this.oldGridParam.rows===a.rows&&this.oldGridParam.cols===a.cols||(this.clearPages(),this.createPages(a)),this.nodes.forEach(k.hitch(this,
function(c,b){this.setItemNodePosition(c,b,a)})),this.oldGridParam=a,b=l("div.close",this.domNode)[0],f.setStyle(b,{width:.25*this.nodeWidth+"px",height:.25*this.nodeWidth+"px"})):(this.oldGridParam=null,f.setStyle(this.domNode,n.getPositionStyle({left:0,top:0,width:0,height:0,zIndex:111})),this.nodeWidth=0)},setItemNodePosition:function(a,b,c){var d,g,h=48,e=16;d=0===b%c.cols?0:this.margin/2;g=b%(c.rows*c.cols)<c.cols?0:this.margin/2;b={};"number"===typeof this.nodeWidth&&(b.width=this.nodeWidth+
"px",b.height=this.nodeWidth+"px");"number"===typeof d&&(window.isRTL?b.marginRight=d+"px":b.marginLeft=d+"px");"number"===typeof g&&(b.marginTop=g+"px");if(d=l("img",a)[0])c.iconScaled&&(h*=this.nodeWidth/120),f.setStyle(d,{width:h+"px",height:h+"px"});if(h=l("div.node-label",a)[0])c.showLabel?(c.iconScaled&&(e*=this.nodeWidth/120),f.setStyle(h,{"font-size":e+"px",display:"block"})):f.setStyle(h,{"font-size":e+"px",display:"none"});f.setStyle(a,b)},clearPages:function(){q.forEach(this.pages,function(a){this.viewStack.removeView(a.pageNode)},
this);e.empty(this.pointsNode);this.pages=[];this.nodes=[]},createPages:function(a){var b,c,d,g;b=Math.ceil(this.items.length/(a.rows*a.cols));for(c=0;c<b;c++)d=e.create("div",{"class":"page"}),this.createPageItems(c,d,a),this.viewStack.addView(d),1<b&&(g=e.create("div",{"class":"point"},this.pointsNode),this.own(m(g,"click",k.hitch(this,this._onPageNodeClick,c)))),this.pages.push({pageNode:d,pointNode:g});0<this.viewStack.views.length&&this._selectPage(0)},_onPageNodeClick:function(a){this._selectPage(a)},
_selectPage:function(a){1<this.pages.length&&(l(".point",this.domNode).removeClass("point-selected"),f.addClass(this.pages[a].pointNode,"point-selected"));this.viewStack.switchView(this.pages[a].pageNode)},createPageItems:function(a,b,c){var d,g,e;d=this.items.length;g=c.rows*c.cols;c=(a+1)*g;e=c-d;c=Math.min(c,d);for(a*=g;a<c;a++)this.createItemNode(a,b);for(a=d;a<d+e;a++)this.createEmptyItemNode(b)},createItemNode:function(a,b){var c;a=this.items[a];c=e.create("div",{"class":"icon-node jimu-float-leading jimu-main-background",
title:a.label,settingId:a.id,"data-widget-name":a.name},b);b=e.create("img",{src:a.icon},c);window.isRTL&&a.mirrorIconForRTL&&f.addClass(b,"jimu-flipx");e.create("div",{"class":"node-label",title:a.label,innerHTML:n.stripHTML(a.label)},c);c.config=a;this.own(m(c,"click",k.hitch(this,function(){this.onNodeClicked(c)})));this.nodes.push(c)},createEmptyItemNode:function(a){a=e.create("div",{"class":"icon-node jimu-float-leading jimu-main-background"},a);this.nodes.push(a);return a},createCloseBtn:function(){var a;
a=e.create("div",{"class":"close"},this.domNode);e.create("div",{"class":"close-inner jimu-main-background"},a);m(a,"click",k.hitch(this,function(){this.hide()}));return a},hide:function(){f.setStyle(this.domNode,"display","none")},show:function(){f.setStyle(this.domNode,"display","block")},onNodeClicked:function(a){this.hide()},_calculateGridParam:function(){var a,b,c,d,e=!1,h=!0;a=f.getContentBox(this.popupContainer);b=Math.min(a.w,a.h)-40;if(360<=b)d=120;else{d=Math.floor(b/3);if(10>d)return null;
e=!0;80>d&&(h=!1)}b=Math.floor((a.h-40)/d);c=Math.floor((a.w-40)/d);b=4<b?4:b;b=3>b?3:b;c=3>b?3:4<c?4:c;return{rows:b,cols:c,cellSize:d,iconScaled:e,showLabel:h,position:{top:(a.h-d*b)/2,bottom:(a.h-d*b)/2,left:(a.w-d*c)/2,right:(a.w-d*c)/2,width:d*c-this.margin*(c-1)/2,height:d*b-this.margin*(b-1)/2,zIndex:111}}}})});